<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaizen! Let it crash with Gerhard Lazu (Changelog &amp; Friends #124)</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.8; color: #e2e8f0; max-width: 800px; margin: 40px auto; padding: 0 20px; background: #0a0e27; }
  h1 { color: #00d9ff; margin-bottom: 0.5em; }
  .metadata { color: #94a3b8; font-size: 0.9em; margin-bottom: 2em; border-bottom: 1px solid rgba(0,217,255,0.2); padding-bottom: 1em; }
  img { max-width: 100%; height: auto; border-radius: 8px; }
  a { color: #00d9ff; }
  p { margin-bottom: 1em; }
  blockquote { border-left: 3px solid #825ee4; padding-left: 15px; color: #94a3b8; }
  code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px; color: #ff79c6; }
  pre { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 6px; overflow-x: auto; }
</style>
</head>
<body>
  <h1>Kaizen! Let it crash with Gerhard Lazu (Changelog &amp; Friends #124)</h1>
  <div class="metadata">
    Source: The Changelog | Date: 1/17/2026 | Lang: EN |
    <a href="https://changelog.com/friends/124" target="_blank">Original Article</a>
  </div>
  <div class="content">
    <div><div>

      <section>
        <a></a>
        <header>
          <h3>Featuring</h3>
        </header>
        <div>
          <ul>

            <li>Gerhard Lazu ‚Äì <a href="https://gerhard.io/">Website</a>, <a href="https://github.com/gerhard">GitHub</a>, <a href="https://www.linkedin.com/in/gerhardlazu">LinkedIn</a>, <a href="https://x.com/gerhardlazu">X</a></li>

            <li>Jerod Santo ‚Äì <a href="https://jerodsanto.net/">Website</a>, <a href="https://github.com/jerodsanto">GitHub</a>, <a href="https://www.linkedin.com/in/jerodsanto">LinkedIn</a>, <a href="https://changelog.social/@jerod">Mastodon</a>, <a href="https://x.com/jerodsanto">X</a></li>

            <li>Adam Stacoviak ‚Äì <a href="https://adamstacoviak.com/">Website</a>, <a href="https://github.com/adamstac">GitHub</a>, <a href="https://www.linkedin.com/in/adamstacoviak">LinkedIn</a>, <a href="https://changelog.social/@adam">Mastodon</a>, <a href="https://x.com/adamstac">X</a></li>

          </ul>
        </div>
      </section>


      <section>
        <a></a>
        <header>
          <h3>Sponsors</h3>
        </header>
        <div>

            <p>
              <strong><a href="https://namespace.so/">Namespace</a></strong> ‚Äì Speed up your development and testing workflows using your existing tools. (Much) faster GitHub actions, Docker builds, and more. At an unbeatable price.
            </p>

            <p>
              <strong><a href="https://depot.dev/">Depot</a></strong> ‚Äì <strong>10x faster builds? Yes please.</strong> Build faster. Waste less time. Accelerate Docker image builds, and GitHub Actions workflows. Easily integrate with your existing CI provider and dev workflows to save hours of build time.
            </p>

            <p>
              <strong><a href="https://www.squarespace.com/changelog">Squarespace</a></strong> ‚Äì A website makes it real! Use code CHANGELOG to save 10% on your first website purchase.
            </p>

        </div>
      </section>


      <section>
        <a></a>
        <header>
          <h3>Notes &amp; Links</h3>
          <p><a href="https://github.com/thechangelog/show-notes/blob/master/friends/changelog--friends-124.md">üìù Edit Notes</a></p>
        </header>
        
      </section>


      <section>
        <a></a>
        <header>
          <h3>Chapters</h3>
        </header>
        <div>
          <table>
            
            <tbody>

                <tr>
                <td>1</td>
                <td>
                  <a href="#t=0">00:00</a>
                </td>
                <td>

Let's Kaizen!


                </td>
                <td>00:38</td>
              </tr>

                <tr>
                <td>2</td>
                <td>
                  <a href="#t=38">00:38</a>
                </td>
                <td>

<a href="https://namespace.so/">Sponsor: Namespace</a>


                </td>
                <td>01:41</td>
              </tr>

                <tr>
                <td>3</td>
                <td>
                  <a href="#t=138">02:18</a>
                </td>
                <td>

Killer starts &amp; Friends


                </td>
                <td>05:23</td>
              </tr>

                <tr>
                <td>4</td>
                <td>
                  <a href="#t=461">07:41</a>
                </td>
                <td>

MacTuner and Mole


                </td>
                <td>04:04</td>
              </tr>

                <tr>
                <td>5</td>
                <td>
                  <a href="#t=706">11:46</a>
                </td>
                <td>

What's next?


                </td>
                <td>00:33</td>
              </tr>

                <tr>
                <td>6</td>
                <td>
                  <a href="#t=739">12:19</a>
                </td>
                <td>

Erlang in Anger


                </td>
                <td>04:29</td>
              </tr>

                <tr>
                <td>7</td>
                <td>
                  <a href="#t=1008">16:48</a>
                </td>
                <td>

Pipedream crashing


                </td>
                <td>03:16</td>
              </tr>

                <tr>
                <td>8</td>
                <td>
                  <a href="#t=1204">20:04</a>
                </td>
                <td>

Quiz! How many crashes?


                </td>
                <td>01:58</td>
              </tr>

                <tr>
                <td>9</td>
                <td>
                  <a href="#t=1322">22:02</a>
                </td>
                <td>

Quiz! Why the crashes?


                </td>
                <td>05:36</td>
              </tr>

                <tr>
                <td>10</td>
                <td>
                  <a href="#t=1658">27:38</a>
                </td>
                <td>

<a href="https://depot.dev/">Sponsor: Depot</a>


                </td>
                <td>02:20</td>
              </tr>

                <tr>
                <td>11</td>
                <td>
                  <a href="#t=1798">29:58</a>
                </td>
                <td>

Quiz! Why more in traffic than out?


                </td>
                <td>02:31</td>
              </tr>

                <tr>
                <td>12</td>
                <td>
                  <a href="#t=1949">32:29</a>
                </td>
                <td>

90s jean shopping


                </td>
                <td>00:43</td>
              </tr>

                <tr>
                <td>13</td>
                <td>
                  <a href="#t=1992">33:12</a>
                </td>
                <td>

What on earth is going on


                </td>
                <td>03:20</td>
              </tr>

                <tr>
                <td>14</td>
                <td>
                  <a href="#t=2192">36:32</a>
                </td>
                <td>

Hot vs cold regions


                </td>
                <td>02:30</td>
              </tr>

                <tr>
                <td>15</td>
                <td>
                  <a href="#t=2342">39:02</a>
                </td>
                <td>

What improved?


                </td>
                <td>01:39</td>
              </tr>

                <tr>
                <td>16</td>
                <td>
                  <a href="#t=2441">40:41</a>
                </td>
                <td>

Examining an instance


                </td>
                <td>02:14</td>
              </tr>

                <tr>
                <td>17</td>
                <td>
                  <a href="#t=2575">42:55</a>
                </td>
                <td>

Gerhard's prompt


                </td>
                <td>02:38</td>
              </tr>

                <tr>
                <td>18</td>
                <td>
                  <a href="#t=2733">45:33</a>
                </td>
                <td>

Claude's analysis


                </td>
                <td>07:09</td>
              </tr>

                <tr>
                <td>19</td>
                <td>
                  <a href="#t=3162">52:42</a>
                </td>
                <td>

Gemini's analysis


                </td>
                <td>04:10</td>
              </tr>

                <tr>
                <td>20</td>
                <td>
                  <a href="#t=3412">56:52</a>
                </td>
                <td>

<a href="https://www.squarespace.com/changelog">Sponsor: Squarespace</a>


                </td>
                <td>01:56</td>
              </tr>

                <tr>
                <td>21</td>
                <td>
                  <a href="#t=3528">58:48</a>
                </td>
                <td>

When all the "fun" begins


                </td>
                <td>04:41</td>
              </tr>

                <tr>
                <td>22</td>
                <td>
                  <a href="#t=3809">1:03:29</a>
                </td>
                <td>

Checking in hourly


                </td>
                <td>01:31</td>
              </tr>

                <tr>
                <td>23</td>
                <td>
                  <a href="#t=3900">1:05:00</a>
                </td>
                <td>

Thanks mayailrus!


                </td>
                <td>01:09</td>
              </tr>

                <tr>
                <td>24</td>
                <td>
                  <a href="#t=3969">1:06:09</a>
                </td>
                <td>

Checking in locally


                </td>
                <td>06:43</td>
              </tr>

                <tr>
                <td>25</td>
                <td>
                  <a href="#t=4372">1:12:52</a>
                </td>
                <td>

All sorts of issues


                </td>
                <td>01:03</td>
              </tr>

                <tr>
                <td>26</td>
                <td>
                  <a href="#t=4435">1:13:55</a>
                </td>
                <td>

That was the easy stuff...


                </td>
                <td>00:19</td>
              </tr>

                <tr>
                <td>27</td>
                <td>
                  <a href="#t=4453">1:14:13</a>
                </td>
                <td>

"It's complicated"


                </td>
                <td>01:16</td>
              </tr>

                <tr>
                <td>28</td>
                <td>
                  <a href="#t=4529">1:15:29</a>
                </td>
                <td>

It's just too much


                </td>
                <td>02:44</td>
              </tr>

                <tr>
                <td>29</td>
                <td>
                  <a href="#t=4693">1:18:13</a>
                </td>
                <td>

Knock on some doors


                </td>
                <td>02:08</td>
              </tr>

                <tr>
                <td>30</td>
                <td>
                  <a href="#t=4821">1:20:21</a>
                </td>
                <td>

Mitigation


                </td>
                <td>03:16</td>
              </tr>

                <tr>
                <td>31</td>
                <td>
                  <a href="#t=5017">1:23:37</a>
                </td>
                <td>

Food for thought


                </td>
                <td>01:04</td>
              </tr>

                <tr>
                <td>32</td>
                <td>
                  <a href="#t=5081">1:24:41</a>
                </td>
                <td>

More mitigation ideas


                </td>
                <td>04:06</td>
              </tr>

                <tr>
                <td>33</td>
                <td>
                  <a href="#t=5327">1:28:47</a>
                </td>
                <td>

How good systems become bad systems


                </td>
                <td>00:48</td>
              </tr>

                <tr>
                <td>34</td>
                <td>
                  <a href="#t=5375">1:29:35</a>
                </td>
                <td>

Jerod's cudgel


                </td>
                <td>04:57</td>
              </tr>

                <tr>
                <td>35</td>
                <td>
                  <a href="#t=5673">1:34:33</a>
                </td>
                <td>

Robust observability


                </td>
                <td>00:20</td>
              </tr>

                <tr>
                <td>36</td>
                <td>
                  <a href="#t=5693">1:34:53</a>
                </td>
                <td>

One last thing


                </td>
                <td>04:40</td>
              </tr>

                <tr>
                <td>37</td>
                <td>
                  <a href="#t=5973">1:39:33</a>
                </td>
                <td>

Bye, friends


                </td>
                <td>00:40</td>
              </tr>

                <tr>
                <td>38</td>
                <td>
                  <a href="#t=6013">1:40:13</a>
                </td>
                <td>

<a href="https://changelog.com/community">Next week on the pod</a>


                </td>
                <td>00:53</td>
              </tr>

            </tbody>
          </table>
        </div>
      </section>

      <section>
        <a></a>
        <header>
          <h3>Transcript</h3>
          <p>

<a href="https://github.com/thechangelog/transcripts/blob/master/friends/changelog--friends-124.md">üìù Edit Transcript</a>

          </p>
        </header>

        <div>

          <div>
            <div>
<a href="https://changelog.com/about">
                
</a>
              <p>Changelog</p>
            </div>
            <p><a href="https://op3.dev/e/https://cdn.changelog.com/uploads/friends/124/changelog--friends-124.mp3">Play the audio</a> to listen along while you enjoy the transcript. üéß</p>
          </div>


            <div>
              
              <p>How else would you learn? Let it crash.</p>
            </div>


            <div>
              
              <p>Exactly. The best things happen when things fail‚Ä¶ [laughter] Seriously. If it‚Äôs in a controlled way, right? I think that‚Äôs something which isn‚Äôt said. It‚Äôs implied. It has to be a controlled failure, where you have the boundary, and things will not blow up. I mean, they‚Äôll blow up, but the fireworks sort of blowing up, where it‚Äôs a controlled explosion.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>Right. Tiny little crashes to learn from. Welcome, everyone, to Kaizen #22, with the incomparable Gerhard Lazu‚Ä¶ He‚Äôs here to let us know how he lets it crash. It‚Äôs that song, ‚ÄúLet it snow, let it snow, let it snow‚Äù, only - you know how to replace‚Ä¶ Hey Gerhard, how are you?</p>
            </div>


            <div>
              
              <p>Hey, Jerod. I‚Äôm good, thank you. Thank you. I had a great holiday. It was a great couple of weeks where I‚Äôve managed to finally disconnect. It‚Äôs been, I don‚Äôt know, 20 years since I had two weeks completely off‚Ä¶</p>
            </div>


            <div>
              
              <p>Nice.</p>
            </div>


            <div>
              
              <p>Even my holidays are only a week. So this was very different, very enjoyable, and I feel so refreshed‚Ä¶ So I‚Äôm firing on all cylinders.</p>
            </div>


            <div>
              
              <p>You unplugged, and now you‚Äôre plugged back in.</p>
            </div>


            <div>
              
              <p>Pretty much.</p>
            </div>


            <div>
              
              <p>Plug it in.</p>
            </div>


            <div>
              
              <p>I stopped it, and I started it, and it‚Äôs brand new.</p>
            </div>


            <div>
              
              <p>It‚Äôs Glade, man. I‚Äôm Glade over here, man. Plug it in, plug it in. You know what I‚Äôm saying? Smell the scent, the fresh New Year‚Äôs scent called 2026‚Ä¶</p>
            </div>


            <div>
              
              <p>Some people are going to say this is going to be the best year ever. I‚Äôve heard it said. What do you think, Gerhard?</p>
            </div>


            <div>
              
              <p>They keep saying that, and I‚Äôm excited about them.</p>
            </div>


            <div>
              
              <p>They said that about 2020. [laughter]</p>
            </div>


            <div>
              
              <p>2020‚Ä¶ We have to admit, it was off to a killer start. I mean, it was really going well.</p>
            </div>


            <div>
              
              <p>Right. Pun intended, killer start‚Ä¶</p>
            </div>


            <div>
              
              <p>What happened in 2020?</p>
            </div>


            <div>
              
              <p>It was COVID. Pun intended? Killer start? That was 2020. 2020 was the year of COVID, and everyone‚Äôs ‚ÄúOh, this is going to be the best year ever‚Äù, and then we had three years of misery. So I think ‚Äì</p>
            </div>


            <div>
              
              <p>Put it behind us.</p>
            </div>


            <div>
              
              <p>I just want an easygoing year. You know what I mean? Last year, 2025, 1st of January, we were building shelves. We were redoing studies and whatnot‚Ä¶ And the whole year was full on. Like, it was nonstop. Every week there was something significant happening. And this year we would for it to be a bit more chill, maybe a bit more meaningful‚Ä¶ So that‚Äôs what we‚Äôre thinking. But how about you, Adam? How are your holidays?</p>
            </div>


            <div>
              
              <p>My holidays were filled with barbecue, and good times.</p>
            </div>


            <div>
              
              <p>Wow. Even in winter‚Ä¶ So barbecue never stops. It doesn‚Äôt know seasons.</p>
            </div>


            <div>
              
              <p>It never stops in Texas. Actually, just to shower you all with a few of my picks from my most recent barbecue adventures‚Ä¶ If you‚Äôre in Zulip, go to the general channel, look for barbecue with three bangs after it, because - why do one bang when you can do three?</p>
            </div>


            <div>
              
              <p>Bang, bang, bang.</p>
            </div>


            <div>
              
              <p>Some recent ribs‚Ä¶ My gosh, my ribs method is on point, my spatchcock chicken method is on point‚Ä¶ No one is disappointed at my barbecue joint.</p>
            </div>


            <div>
              
              <p>Very nice. Look at that, we‚Äôre going to add some meat on this slide‚Ä¶ That‚Äôs what happened in real time.</p>
            </div>


            <div>
              
              <p>Wow. Real-time meat added. This is ‚Äì this is intense.</p>
            </div>


            <div>
              
              <p>Yeah. And again, just to be clear, it‚Äôs Adam‚Äôs barbecue. Okay? So no joking aside, we‚Äôre talking about barbecue.</p>
            </div>


            <div>
              
              <p>Well‚Ä¶</p>
            </div>


            <div>
              
              <p>I think we have to leave it there‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>Let‚Äôs move on.</p>
            </div>


            <div>
              
              <p>I think we have to leave it there.</p>
            </div>


            <div>
              
              <p>I didn‚Äôt show a burger, but I do make a mean burger, too. Thank you, Gerhard, for assuming that is something I do rock really good. My smash burgers are on point.</p>
            </div>


            <div>
              
              <p>Very nice, very nice. I‚Äôm looking forward to that. And so‚Ä¶</p>
            </div>


            <div>
              
              <p>One day‚Ä¶</p>
            </div>


            <div>
              
              <p>My favorite Christmas tree - this is what it looked like.</p>
            </div>


            <div>
              
              <p>Oh, yes.</p>
            </div>


            <div>
              
              <p>Hm‚Ä¶ What is that?</p>
            </div>


            <div>
              
              <p>And for those that are listening, it‚Äôs a networking cabinet. There‚Äôs lots of blue lights flashing. This is happening in the loft‚Ä¶ You have many terabits of network throughput. There‚Äôs some switches, there‚Äôs UniFi, there‚Äôs Mikrotik‚Ä¶ This is maybe five years in the works, and every Christmas I take time to improve it little by little. So this year I went really crazy. I redid the whole thing. I redid the whole, for example, DHCP network, VLAN‚Ä¶ Man, it‚Äôs beautiful.</p>
            </div>


            <div>
              
              <p>Your VLANs are beautiful‚Ä¶</p>
            </div>


            <div>
              
              <p>They are. They are.</p>
            </div>


            <div>
              
              <p>I want to be a guest on your network, man. I‚Äôm going to get blocked from everything, okay?</p>
            </div>


            <div>
              
              <p>Well, well, there‚Äôs a big story happening in the background, and it is going to be ‚Äì I think this will be amazing. This is will be the best network that I have run in my life‚Ä¶ But the blue, and the darkness, and it‚Äôs like ‚Äì that was one more Christmas tree in our house, and this was it, where I would just go and tinker for a few hours in between the Christmas dinner and all the Christmas festivities‚Ä¶ So it was nice just to spend a bit of time tinkering with hardware. And I‚Äôm sure that many of you listening, when it comes Christmas time, when things start quieting down, you get the little projects that you didn‚Äôt have time for throughout the year, and then you have some fun. So I‚Äôm wondering, did any of you did anything fun this Christmas? ‚Ä¶but nerdy fun, that‚Äôs what I mean by that.</p>
            </div>


            <div>
              
              <p>Nerdy fun‚Ä¶ Well, I got upset with something‚Ä¶</p>
            </div>


            <div>
              
              <p>That‚Äôs not fun.</p>
            </div>


            <div>
              
              <p>[<a href="#t=00:07:47.23">00:07:47.23</a>] ‚Ä¶and so I decided to just let it roll. You know what I‚Äôm trying to say? I got upset with the amount of RAM usage on my machine‚Ä¶ And while I liked the application, I was like ‚ÄúYou know what? I‚Äôm just kind of tired of having four gigs‚Äì‚Äù I think it was ‚Äì no, it was like 1.2 gigs of RAM being used by Clean my Mac‚Ä¶ Fancy little utility application, helps you tune, and pay attention, and stuff like that‚Ä¶ And I decided to remake it, and that was it. So I remade it. It‚Äôs called Mac Tuner. I know there used to be a MacTuner.com, which was, I think, a Mac Magazine, I believe‚Ä¶ But Mac Tuner fit. I might change it, who knows‚Ä¶ But for now it‚Äôs called Mac Tuner. It does all the things, all the things. Analyze, clean up, uninstall‚Ä¶ And not just that fake uninstall; the real one, where you get the dirty dirties out. You know what I‚Äôm saying, the dirties? All the dirties are out, okay?</p>
            </div>


            <div>
              
              <p>My mind is on the dirty burger that you mentioned earlier‚Ä¶ [laughter]</p>
            </div>


            <div>
              
              <p>Yeah. I mean, that‚Äôs about as nerdy as I can get. I mean, I made a little utility that‚Äôs for me for now. Soon to be open source, though; soon to be.</p>
            </div>


            <div>
              
              <p>It will be soon.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>Very nice.</p>
            </div>


            <div>
              
              <p>I mean, why not, right? Share with the world.</p>
            </div>


            <div>
              
              <p>Well, I didn‚Äôt create a Mac Tuner, but I‚Äôve found one. I also was thinking, Clean my Mac - how long am I going to run this thing? And the answer is ‚ÄúAs long as I ran it, because I‚Äôm done now.‚Äù I found a tool called Mole, M-O-L-E, which is a command line macOS cleaner that does everything. So maybe you‚Äôve got some competition here, Adam. Maybe you can come out and throw some blows down, like ‚ÄúHere‚Äôs why I‚Äôm better than Mole.‚Äù It‚Äôs got a TUI, it‚Äôs all command line-based, it does cleaning, optimizing, uninstalling, DaisyDisk, Explorer‚Ä¶</p>
            </div>


            <div>
              
              <p>Oh, gosh.</p>
            </div>


            <div>
              
              <p>‚Ä¶all from ‚Äì yeah.</p>
            </div>


            <div>
              
              <p>I‚Äôm feeling it. I‚Äôm feeling intimidated over here, okay?</p>
            </div>


            <div>
              
              <p>You‚Äôre starting to sweat?</p>
            </div>


            <div>
              
              <p>I think he just changed his mind about open-sourcing it.</p>
            </div>


            <div>
              
              <p>Here‚Äôs your domain name idea, Adam. [unintelligible <a href="#t=00:09:45.15">00:09:45.15</a>]</p>
            </div>


            <div>
              
              <p>That‚Äôs good. I could do that.</p>
            </div>


            <div>
              
              <p>So I‚Äôve been using that, and I‚Äôm very excited, because who doesn‚Äôt want to just have all the things right there in their command line? And I didn‚Äôt spend any tokens on it. Adam‚Äôs got some tokens involved, but his also works the exact way he wants it to.</p>
            </div>


            <div>
              
              <p>Yeah. Yeah, absolutely. Mine leverages some Recast stuff as well. It‚Äôs kind of cool.</p>
            </div>


            <div>
              
              <p>Sweet. Open source that sucker.</p>
            </div>


            <div>
              
              <p>One day.</p>
            </div>


            <div>
              
              <p>Which day is that?</p>
            </div>


            <div>
              
              <p>Not today. [laughter] Definitely not right now.</p>
            </div>


            <div>
              
              <p>But it‚Äôs going to be one day‚Ä¶</p>
            </div>


            <div>
              
              <p>One day. There‚Äôs a bigger launch awaiting, is all I‚Äôll say. There‚Äôs a bigger launch awaiting till I‚Äôm going to open-source some things.</p>
            </div>


            <div>
              
              <p>I‚Äôve been using AppCleaner for many, many years‚Ä¶ Now, there‚Äôs no TUI, there‚Äôs no CLI. It‚Äôs just a regular app. It‚Äôs a really old one.</p>
            </div>


            <div>
              
              <p>Butt you just drag and drop onto it, right?</p>
            </div>


            <div>
              
              <p>Pretty much, yeah. And you also have a list of applications‚Ä¶ But it‚Äôs so old that it‚Äôs difficult to find it these days, and it hasn‚Äôt updated in a very long time‚Ä¶ So I will check Mole out.</p>
            </div>


            <div>
              
              <p>Mole‚Äôs really cool. Brew-install Mole and you‚Äôre done. So you can check it out right here while we‚Äôre talking. And I liked AppZapper‚Ä¶ And I think AppZapper doesn‚Äôt exist anymore, but the cool thing about that was that it would literally make the zap sound, as it ‚Äì yeah. You drop your app on it and it zapped it. And I just liked that sound.</p>
            </div>


            <div>
              
              <p>That‚Äôs the only feature that your application needs to have, Adam. If it zaps‚Ä¶</p>
            </div>


            <div>
              
              <p>Mole does not zap, so there you have it.</p>
            </div>


            <div>
              
              <p>‚ÄúMake it zap‚Äù is our tagline, actually. Make it zap.</p>
            </div>


            <div>
              
              <p>Make it zap.</p>
            </div>


            <div>
              
              <p>There you go. I think that‚Äôs a very good debate, actually.</p>
            </div>


            <div>
              
              <p>What about you, Gerhard, besides your Christmas tree? Did you‚Ä¶?</p>
            </div>


            <div>
              
              <p>I will come back to that. I will come back to the Christmas tree, yeah.</p>
            </div>


            <div>
              
              <p>This guy‚Äôs got stories, man.</p>
            </div>


            <div>
              
              <p>Oh, man. Oh, yes. I have to tease them and be very disciplined, because there‚Äôs too much stuff. So I have to be very careful, because it will be an hour and I will not shut up talking about this thing. I mean, it‚Äôs just like ‚Äì anyway. So we will come back to that, I promise.</p>
            </div>


            <div>
              
              <p>Okay.</p>
            </div>


            <div>
              
              <p>[<a href="#t=00:11:45.18">00:11:45.18</a>] Last time, when we finished Kaizen #21, this was one of the last thoughts that we shared, which is what‚Äôs next. So BAM‚Ä¶ Remember BAM? That happened live. OOM crashes, out of memory crashes, and a bunch of other things. The good news is that only one thing happened. OOM crashes‚Ä¶</p>
            </div>


            <div>
              
              <p>You‚Äôve only got one thing to talk about‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>‚Ä¶but this rabbit hole is really, really deep.</p>
            </div>


            <div>
              
              <p>Okay. Alright. Take us down the rabbit hole. The OOM, out of memory.</p>
            </div>


            <div>
              
              <p>Who remembers this book? Erlang in Anger.</p>
            </div>


            <div>
              
              <p>Erlang in Anger.</p>
            </div>


            <div>
              
              <p>Stuff Goes Bad, by Fred Hebert. Ferd.ca.</p>
            </div>


            <div>
              
              <p>Now, I remember ‚ÄúLearn You Some Erlang for Great Good‚Äù, but I do not remember this one in particular. So I‚Äôm not sure why the other one hit my radar, because he wrote both of them, it seems‚Ä¶ But when did this one come out?</p>
            </div>


            <div>
              
              <p>So this one, if I look ‚Äì I just switched to the browser‚Ä¶ 2016, 2017, while he was still at Heroku. Remember Heroku? Those were the days.</p>
            </div>


            <div>
              
              <p>I do.</p>
            </div>


            <div>
<p>So about 10 years ago. And Fred ‚Äì I mean, if you don‚Äôt know his blog‚Ä¶ It‚Äôs just amazing. I‚Äôll just click it very quickly, just to have a look‚Ä¶ I think it‚Äôs one of the best blogs out there. There‚Äôs so much goodness here. So much. But one of my favorites is queues, and queuing, and how queues don‚Äôt protect from overload. So queues don‚Äôt fix overload. And this is so relevant to today‚Äôs conversation as well. But there‚Äôs a lot of stuff in the Erlang ecosystem, and there‚Äôs many, many things that Fred wrote over the years, that are so relevant to today.</p>
<p>So if I click on Download PDF - by the way, this is a‚Ä¶ It‚Äôs amazing this book is open source. You can download it, open source, freely available, Creative Commons license‚Ä¶ And I‚Äôm going to make this a little bit bigger, so we can see what‚Äôs happening. And if I search for ‚ÄúLet it crash‚Äù, it‚Äôs page number one. It‚Äôs in the introduction.</p>

              </div>


            <div>
              
              <p>There you go. Page one.</p>
            </div>


            <div>
              
              <p>Page one. And this idea of ‚ÄúLet it crash‚Äù really comes from the Erlang ecosystem. It‚Äôs very well renowned there because of how the Erlang VM works, and how all the processes, and the supervision trees just ‚Äì it was built this way. And we know a thing or two about Erlang, Jerod, right? ‚Ä¶because the application, Elixir, the Phoenix framework runs on the same principle.</p>
            </div>


            <div>
              
              <p>I know a thing, and you know two, so that‚Äôs how we get to a thing or two.</p>
            </div>


            <div>
              
              <p>And Adam - I‚Äôm sure he knows the big one. But we don‚Äôt know whether he‚Äôs going to share it. The point is, when you think about ‚ÄúLet it crash‚Äù, Jerod, from your development experience with Erlang, with Elixir, Phoenix - is there any situation, any moment where you could experience it and you realized ‚ÄúHuh, that‚Äôs nice‚Äù?</p>
            </div>


            <div>
              
              <p>When I let it crash?</p>
            </div>


            <div>
              
              <p>When you let it crash.</p>
            </div>


            <div>
              
              <p>Well, it‚Äôs nice that the [unintelligible <a href="#t=00:14:49.07">00:14:49.07</a>] seems to handle a lot of the problems with letting it crash. It just goes again, or there‚Äôs a supervision tree, and things watching each other, and I don‚Äôt have to think about it very much. I can‚Äôt think of an instance in development where I was like ‚ÄúThis is really useful‚Äù, but I‚Äôm sure you could come up with one.</p>
            </div>


            <div>
<p>Yeah. So you know when you write code, we tend to write code very defensively‚Ä¶ Typically try/catch. So you feel like you need to account for every single scenario. And the ‚ÄúLet it crash‚Äù philosophy is about not preventing failure; learning from it. What that means is you need to have a context where it‚Äôs safe for things to crash, and the overall system will still remain stable.</p>
<p>So how can you build a resilient system - and really, this is about resiliency - where the core of the system will remain running, and the system as a whole will remain running even though parts of it may experience failures? ‚Ä¶but those failures will not bring everything down. And that‚Äôs really important. So fewer try/catch blocks, don‚Äôt code defensively, let it crash, and separate the code that solves the problem from the code that fixes the failures. And the more you can lean into the framework, or the VM, or whatever you have - the system - to deal with failures, the better off you are to focus on the things that are unique to your application.</p>

              </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>[<a href="#t=00:16:12.15">00:16:12.15</a>] And Erlang is well renowned for that.</p>
            </div>


            <div>
              
              <p>Kind of the opposite philosophy that Go took, as I write some Go code and I write some Elixir code‚Ä¶ Where with Go it‚Äôs handle every error condition right after you potentially raise one, and make sure that there‚Äôs no error. And if you‚Äôre not dealing with it, then you‚Äôre not writing robust software. And the other philosophy is ‚ÄúLet it crash and deal with it elsewhere.‚Äù I think they‚Äôre both legitimate, depending on what you‚Äôre building.</p>
            </div>


            <div>
              
              <p>Agreed. Well, in our case, we had a lot of crashes to deal with‚Ä¶ [laughter]</p>
            </div>


            <div>
              
              <p>Yeah, we‚Äôre taking the Erlang style‚Ä¶</p>
            </div>


            <div>
              
              <p>Oh, gosh‚Ä¶</p>
            </div>


            <div>
              
              <p>So what we are going to have a look at is all the times that the Pipe Dream has been crashing since our last Kaizen. So since Kaizen 2021, which is October 17th, we had a lot of crashes. And there‚Äôs a certain property about the system - and this is Varnish specifically that made these crashes pretty okay. And the property which I‚Äôm referring to is when you start the varnishd, the daemon, Varnish itself runs as a thread, and you have many, many threads that do different things. So when we had these out of memory crashes, all that happened - the thread was killed. Which means that the system as a whole didn‚Äôt crash, the VM didn‚Äôt, the Firecracker VM didn‚Äôt crash‚Ä¶ The application needed to restart. It was just a thread that was using too much memory, and it restarted within seconds, as in maybe two seconds, and everything was back to normal. Obviously, the cache was cold, but it was good. And that‚Äôs why the memory looked a bit interesting, in that it doesn‚Äôt release all the memory, the VM doesn‚Äôt restart‚Ä¶ There‚Äôs not many hangs; it restarts and it crashes really, really quickly. So that‚Äôs a nice property.</p>
            </div>


            <div>
              
              <p>Well, that confuses me. So how does Fly know about it then, if it‚Äôs just happening inside of Varnish?</p>
            </div>


            <div>
              
              <p>So it‚Äôs looking at the process ID, ‚ÄúWhich process uses the most memory?‚Äù And it‚Äôs the same process that‚Äôs asking for more memory. So basically, it will just send a signal to that process, and kill that process. But that is just a thread; that maps to a thread. So Varnish itself didn‚Äôt crash; it‚Äôs just a thread that maps to a process ID that crashed, and then it was restarted by the Varnish daemon.</p>
            </div>


            <div>
              
              <p>Okay, so where is Fly involved in that? Because Fly is ,aware because I see all these Fly notices, and I get the Fly emails.</p>
            </div>


            <div>
              
              <p>Right. So Fly is aware that there is a process on the machine that is using too much memory, and more memory is being requested. And then it looks like ‚ÄúOkay, which process do I kill?‚Äù And in this case, a process with the most memory will get shot, and will get killed.</p>
            </div>


            <div>
              
              <p>So Fly as a platform can actually reach in and kill that process without killing the machine, rebooting the VM, or Firecracker, or whatever?</p>
            </div>


            <div>
<p>So the Fly platform - it integrates with that functionality, which is a Kernel, it‚Äôs a Linux functionality. That‚Äôs why an out of memory crash would happen even if you have a single machine; you have too much memory, you don‚Äôt have any swap‚Ä¶ How do you basically give more memory when there‚Äôs no memory left, and when the system is becoming unstable? So then you get just a single process which gets killed. In Fly‚Äôs case, they surface that. They surface the fact that there was an out of memory crash, there was an out of memory event, and they send you an email when that happens. It doesn‚Äôt mean that the machine had to restart, it doesn‚Äôt mean that it stopped serving traffic‚Ä¶ It just means there was something that just had to go away, because it was using too much memory.</p>
<p>When I say ‚Äútoo much memory‚Äù, obviously it‚Äôs a bit more complicated than that, because something was asking for memory, the kernel didn‚Äôt have any more memory to allocate, so it just had to look at what needs to be killed, so that I can allocate more memory‚Ä¶ Because something is using too much memory. And it just so happens it would be this process, and this thread. So how many crashes do you think that the Pipe Dream had since Kaizen 2021, since October? So we‚Äôre talking about three months, maybe a bit more than that‚Ä¶</p>

              </div>


            <div>
              
              <p>[<a href="#t=00:20:16.01">00:20:16.01</a>] So Gerhard has presented us a multiple choice quiz. A is 20, B is 40, C is 80, D is 160. Now, I know that I personally receive an email every time this happens, and so I have a little bit of a feeler into this. I delete them, so I can‚Äôt go do a quick search. Adam, do you get emails when these Fly things crash?</p>
            </div>


            <div>
              
              <p>I don‚Äôt.</p>
            </div>


            <div>
              
              <p>Okay, good for you.</p>
            </div>


            <div>
              
              <p>Not to my knowledge. And if I do, they‚Äôre in a box that doesn‚Äôt get looked at.</p>
            </div>


            <div>
              
              <p>You‚Äôve been saving on some email bandwidth‚Ä¶</p>
            </div>


            <div>
              
              <p>I do know, because we send the email‚Ä¶ So let‚Äôs go back to this one. If I click on this one‚Ä¶ Let‚Äôs take this one, and you can see everyone that gets an email. I‚Äôm just going to make this a little bit bigger, so you can see it services Jerod, Adam and Gerhard.</p>
            </div>


            <div>
              
              <p>Oh, you do get it.</p>
            </div>


            <div>
              
              <p>I do get it.</p>
            </div>


            <div>
              
              <p>Yeah. So there must be a filter‚Ä¶</p>
            </div>


            <div>
              
              <p>He just doesn‚Äôt look at it.</p>
            </div>


            <div>
              
              <p>A superhuman saving me. Nice‚Ä¶</p>
            </div>


            <div>
              
              <p>That‚Äôs okay. So what do we think?</p>
            </div>


            <div>
              
              <p>Good thing other people are looking at it‚Ä¶</p>
            </div>


            <div>
              
              <p>It‚Äôs not an Adam problem. That‚Äôs the thing. So that‚Äôs a good thing. He‚Äôs doing the right thing. He‚Äôs just saving his inbox for more important messages.</p>
            </div>


            <div>
              
              <p>They ran an LLM on that to the side. So I feel like 160 is too many. I don‚Äôt think I‚Äôve gotten 160 emails since October on this particular thread. 20 feels not enough. I‚Äôve certainly got more than 20 emails. So I‚Äôm between 40 and 80, and I‚Äôm going to think that ‚Äì gosh, that‚Äôs a tough one. I‚Äôm going to go with 40. Adam, what do you think?</p>
            </div>


            <div>
              
              <p>I‚Äôd go with 40 as well.</p>
            </div>


            <div>
              
              <p>Oh, I got it. Yes‚Ä¶!</p>
            </div>


            <div>
              
              <p>43 exactly.</p>
            </div>


            <div>
              
              <p>The price is right.</p>
            </div>


            <div>
              
              <p>The price is right. Alright, cool.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>43 crashes from October to December; through the end of the year.</p>
            </div>


            <div>
              
              <p>Yeah. And then obviously, there were periods when we had quite a few. So if we were to think about what could be happening in Varnish that it‚Äôs running out of memory and crashing‚Ä¶ So this is us trying to think about the sort of traffic that we serve, trying to think about everything ‚Äì I mean, now we see every single request that hits Changelog, the CDN as well‚Ä¶ And it‚Äôs a lot of requests.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>So there was something in the system that was using way too much memory, and as a result, the process - or the thread in this case - was crashing.</p>
            </div>


            <div>
              
              <p>I mean, I could guess it, but I might even have some insight. So‚Ä¶ Should I just say it, or do you want Adam to guess? I mean, my guess based on - also I saw some emails flying through, but‚Ä¶ Already I would have suspected that we just have too many large files. These 60 to 80 to 100 megabyte MP3 files loaded into memory, flying every which direction‚Ä¶ And you just can‚Äôt load up that much memory without some sort of fancy freeing mechanism. And it‚Äôs just trying to hold all these MP3s in RAM, I think, and it just can‚Äôt do it. So that‚Äôs my guess.</p>
            </div>


            <div>
              
              <p>Yeah. That was a good guess. And I think ‚Äì the next question is going to be to the audience, because we know too much.</p>
            </div>


            <div>
              
              <p>How are they going to answer it? It‚Äôs not real time.</p>
            </div>


            <div>
              
              <p>Well, just think about it‚Ä¶ We will give some time for people to think.</p>
            </div>


            <div>
              
              <p>Okay. We‚Äôll do like a delay here. So if they have a ‚Äì what‚Äôs it called? The feature where you skip silences on‚Ä¶ They‚Äôre not gonna have any time to think about this.</p>
            </div>


            <div>
              
              <p>Right. Okay.</p>
            </div>


            <div>
              
              <p>So quickly, turn that feature off, give yourself some time to think‚Ä¶ Go ahead.</p>
            </div>


            <div>
<p>Yeah. Or pause. We can also say pause. Now is a good time to pause. And then - what could be the problem? So you‚Äôre right - all those large files. We had all the MP3 files; many, many MP3 files. They‚Äôre large. All trying to be cached in memory. And that was a problem. So what is many? Well, we have thousands at this point, of MP3 files, across all the podcasts, since the beginning of time. Large - large means anywhere from 30-40 megabytes, to 100+ megabytes. So that‚Äôs ‚Äì I mean, just think, if you had to load a thousand files, that take 100 megabytes‚Ä¶ That‚Äôs a lot of memory that you need to have available.</p>
<p>[<a href="#t=00:24:30.17">00:24:30.17</a>] And the problem is that once you store these large files, as we discovered, you get memory fragmentation, in that - imagine that you have all the memory available, you keep storing all these files, and at some point there‚Äôs no more memory left. So what do you do? Well, you need to see what can you evict from memory, so that you can store the new file. So imagine that you evict a few of those objects, but maybe they aren‚Äôt big enough, and you haven‚Äôt evicted them fast enough. So then you have this big file that can‚Äôt fit anywhere, because the sizes, the holes that you have in memory aren‚Äôt big enough for this file to fit. And there‚Äôs no defragmentation, or nothing like that that runs in the background‚Ä¶ Which means that even though technically you kind of would have space in the memory, for the specific files you may not. And then it can‚Äôt be stored in memory. Now, the thing in Varnish is actually called - I kid you not - n_lru_nuked.</p>

              </div>


            <div>
              
              <p>Nice.</p>
            </div>


            <div>
<p>So I think the connection to the nuke and to the book, and to ‚ÄúLet it crash‚Äù is right there. So lru_nuked, basically - it‚Äôs like a forced eviction. So it‚Äôs an event where an object has to be evicted from the cache just to make room for a new one, because the storage is full. So you can see how many times this has happened. And that‚Äôs like an important metric that if we look at, we can see, ‚ÄúWe had too many of these events.‚Äù Many objects were being nuked from memory to make room for new objects, but sometimes they wouldn‚Äôt fit.</p>
<p>So how badly did it nuke? Because we can measure this, we can look at this. And this is what that looks from a memory perspective. So you can see that the instance was running about maybe four gigs of memory, and then we had a massive spike within minutes, like one or two minutes, to 16 gigabytes. So that‚Äôs a lot of data that had to be fit in memory. And you can already see where this is going‚Ä¶ Scrapers, and bots, and LLMs‚Ä¶ We have so many things happening. And then you can see the memory, it went up. The thread was killed, the child was killed‚Ä¶ The Varnish [unintelligible <a href="#t=00:26:40.14">00:26:40.14</a>] memory came down again, and then it went up again. So the graph that we see here, we can see the first spike, just like maybe a minute apart‚Ä¶ The second spike, another crash‚Ä¶ It took a little while for it to restore. We‚Äôre talking maybe 10 seconds. And then we stabilized around 10 gigabytes. From a CPU perspective, we got like a hundred percent CPU utilization when this happens. Everything is full on, everything ‚Äì the instance is really struggling to allocate and deallocate and free up memory‚Ä¶ And more importantly, we have a lot of traffic flowing through. So how much? 2.29 gigabits, specifically. 2.29 gigabits‚Ä¶</p>

              </div>


            <div>
              
              <p>Per second.</p>
            </div>


            <div>
<p>Per second, exactly. And these happen so quickly; you have a huge rush of traffic coming in‚Ä¶ And then nothing.</p>
<p><strong>Break</strong>: [<a href="#t=00:27:40.00">00:27:40.00</a>]</p>

              </div>


            <div>
              
              <p>So why is more traffic coming into the instance than going out? So this is the traffic that the instance is receiving. So we‚Äôre receiving 2.29 gigabits, but we‚Äôre only sending 145 megabits. Now is a good time to pause and think about why this is happening.</p>
            </div>


            <div>
              
              <p>Yeah, don‚Äôt skip silence. So when we say the instance, we mean the Varnish instance.</p>
            </div>


            <div>
              
              <p>The Varnish instance, yeah.</p>
            </div>


            <div>
              
              <p>Which sits between our end user, whatever that is - or users - and our application. Well, actually, and our Cloudflare, not our application.</p>
            </div>


            <div>
              
              <p>All our backends. And we have a couple of backends.</p>
            </div>


            <div>
              
              <p>Yes, but in the case of MP3 files it‚Äôs our R2 origin.</p>
            </div>


            <div>
              
              <p>That‚Äôs correct.</p>
            </div>


            <div>
              
              <p>So Varnish is receiving a bunch of data, and sending back an order of magnitude less data. And what‚Äôs it receiving - I don‚Äôt know, man. I mean, my guess would be we‚Äôre uploading MP3s‚Ä¶ Now, that‚Äôs gonna go straight through the app to R2‚Ä¶ Just a DDoS? I mean, what is it? I don‚Äôt know.</p>
            </div>


            <div>
              
              <p>Yeah‚Ä¶ So it is a DDoS, but it‚Äôs specifically downloading MP3 files, or starting to download MP3 files, but never finishing.</p>
            </div>


            <div>
              
              <p>Hanging‚Ä¶</p>
            </div>


            <div>
              
              <p>So you get all these requests for MP3 files, for large files‚Ä¶ Varnish is going and fetching them as quickly as it can‚Ä¶ So pulling all this data in, so it has it in memory, but the client is never around long enough.</p>
            </div>


            <div>
              
              <p>It terminates.</p>
            </div>


            <div>
              
              <p>Yeah, exactly. So they basically abort, but Varnish is still pulling in all the data. Now, there is a property‚Ä¶ It‚Äôs called bresp.doStreamTrue. So what this does - a very weird thing - is it tells Varnish not to buffer the entire backend response if the client is slow. So I‚Äôm not going to fetch the entire MP3 file if you only want the first, I don‚Äôt know, minute, or two, or a range, or something like that. Now, this is on by default. So by default, that‚Äôs how Varnish behaves. So we wouldn‚Äôt need to enable this. But if the object is uncacheable, it cannot be stored in cache - do you see where I‚Äôm going with this? Memory, you can‚Äôt store it in memory‚Ä¶ So you keep pulling these files over and over again, and maybe even just fragments of them‚Ä¶ So even though the client never receives them, you may be pulling hundreds of files, and the client just goes away. So you‚Äôre not pulling the entire file, but you‚Äôre still pulling enough, and not able to fit it anywhere, and it just becomes a mess.</p>
            </div>


            <div>
              
              <p>This reminds me of the ‚Äô90s, when you used to go jean shopping‚Ä¶</p>
            </div>


            <div>
              
              <p>[laughs] Tell us‚Ä¶ Do tell, Adam.</p>
            </div>


            <div>
              
              <p>And you‚Äôd go into Abercrombie &amp; Fitch - which I never shopped at, but let‚Äôs just imagine I did‚Ä¶ I‚Äôd go in there and be like ‚ÄúI like all these jeans. Get them all.‚Äù I‚Äôm trying them all on, and then I just bounce.</p>
            </div>


            <div>
              
              <p>Yeah, the person goes to collect them all, they come back and you‚Äôre not there.</p>
            </div>


            <div>
              
              <p>Here‚Äôs a dressing room full of jeans, and Adam‚Äôs gone. Bye-bye. See ya.</p>
            </div>


            <div>
              
              <p>This really sounds like you‚Äôre speaking from experience. Was this a prank [unintelligible <a href="#t=00:32:54.20">00:32:54.20</a>]</p>
            </div>


            <div>
              
              <p>I just made it up just now. I‚Äôm just creative like that, you know? On the fly. Creativity.</p>
            </div>


            <div>
              
              <p>[laughs] That‚Äôs a good one. That‚Äôs a good one. On the fly, yes.</p>
            </div>


            <div>
              
              <p>It is on the fly‚Ä¶</p>
            </div>


            <div>
              
              <p>It is. On the fly.io. Boom!</p>
            </div>


            <div>
              
              <p>Well, what could we do then? What‚Äôs going on here?</p>
            </div>


            <div>
<p>Exactly. So this was one of the things which I had to deep-dive and understand what on Earth is going on. Where do we store, what‚Äôs happening‚Ä¶ So there‚Äôs a lot, lot more that went into this pull request. It‚Äôs pull request 44. I‚Äôm calling it ‚ÄúThe elephant in the room.‚Äù I‚Äôm going to switch to the browser, just to have a look at that.</p>
<p>So the title of the pull request is ‚ÄúStoring MP3 files in the file cache.‚Äù But that‚Äôs the tip, right? The most obvious thing is, ‚ÄúWell, you either have lots and lots of memory to give varnish‚Äù, which honestly would be impractical, in the sense that would be way too expensive to store all these files in memory. The next best thing is to have something like a file cache. And by the way, we‚Äôre talking about open source Varnish. That‚Äôs really important. Anyone can use this, anyone can configure this‚Ä¶ You can configure a file cache, which will basically pre-allocate a file on disk, and that‚Äôs where these large files will be stored. Pull request 44, the one that we‚Äôre looking at, is in the Pipely repository. That‚Äôs what this adds.</p>
<p>[<a href="#t=00:34:19.08">00:34:19.08</a>] But there‚Äôs significantly more stuff‚Ä¶ And if I‚Äôm going to ‚Äì so there‚Äôs quite a few files. I highlighted a few, so I‚Äôm going to look at this one‚Ä¶ So it‚Äôs not just that. You also need to tune, for example, thread pools, you need to tune the minimum, the maximum‚Ä¶ You need to tune the workspace backend, like ‚ÄúHow many memory structures get allocated?‚Äù You need to configure the nuke limit‚Ä¶ And there‚Äôs a couple more things that we had to go through, just to make things stable.</p>
<p>Now, I‚Äôm just going to very quickly mention these things. You can go and have a look at the pull request to see what else went into it.. So this was the one file. The other one was the regions. That‚Äôs another thing. Not all regions would suffer from this. So you don‚Äôt want to allocate too much memory or too much CPU to regions where maybe they don‚Äôt get a lot of traffic. And you would think that this thing is easy, but oh man, I have a surprise for you‚Ä¶ You can‚Äôt mix and match sizes easily in Fly. So you can‚Äôt say ‚ÄúCreate application groups, and this group will be the small group, and that group will be the big group, and this is just one application‚Ä¶‚Äù</p>

              </div>


            <div>
              
              <p>Really‚Ä¶?</p>
            </div>


            <div>
<p>It‚Äôs not straightforward. So you have to ‚Äì again, this is how I solved it. Maybe someone listening to this will tell me, ‚ÄúHey, Gerhard, you‚Äôre wrong.‚Äù I would love to know that, seriously. So the way I solved it is we deploy in all the regions, because you specify the size once. So you say ‚ÄúMy starting size is the large instance type.‚Äù It has a certain number of cores, a certain number of memory‚Ä¶ And by the way, the disk is the same in all of them, because that‚Äôs another problem, so we will sidebar that, or put a pin in that.</p>
<p>So when it comes to the initial deployment, you deploy the one size across all the application instances, and then you go and need to check to see which instances should be scaled down, so that you have the capacity, but the regions that don‚Äôt need the capacity can just bring them down. And you do a rolling deploy, in that you replace one for one, you have plenty of capacity to handle the traffic while instances are being rolled‚Ä¶ All that good stuff. But we have hot regions, and then we have cold regions. And there‚Äôs quite a few things here. Again, if someone knows how to do this better, I would love to hear about that.</p>
<p>And we have the TOML, we have the primary region‚Ä¶ There‚Äôs a couple of things here‚Ä¶ We‚Äôll come back to services and ‚Äì HTTP services. That‚Äôs a fun one. We‚Äôll leave that for a little bit later. Fly Just‚Ä¶ We can see how we do the flyctl deploy, we disable HA, because we want only one instance per region‚Ä¶ We have 15 regions in total. We specify the CPUs, the memory, all that good stuff, including environment variables‚Ä¶ Oh, that‚Äôs another thing - we need to adjust the Varnish size based on the memory the instance has. We need to say ‚ÄúHey, Varnish, you get 70%.‚Äù And that‚Äôs the other thing that this does. Same thing for the file size. You can‚Äôt take up the entire disk. We tell you, based on the disk that we provision, how much space you should use from the disk that gets created. There‚Äôs a scaling there, so that‚Äôs another good one‚Ä¶</p>
<p>I‚Äôm going through the pull request to see if there‚Äôs anything else. Oh man, this was a pain‚Ä¶ So recreating ‚Äì like, writing tests for this. Everything is tested, in the sense that which requests would go, or basically which files would get cached in the file store, and which files would be cached in the memory store. So how do you write the tests? Some Varnish logging is included, you have to have anchors‚Ä¶ There‚Äôs quite a few things. So that‚Äôs assetsbackend.vtc. And part of this - it was a huge refactoring.So if you look at the lines of code, I wouldn‚Äôt say it‚Äôs that many. 1,500 were added, and 1,470 were deleted. So not much changed. I mean, the net is 30 new lines were added. But there was a huge, massive refactoring part of this.</p>
<p>[<a href="#t=00:38:21.16">00:38:21.16</a>] So there‚Äôs ‚Äì again, this was, I think, two-three days of figuring it out, trying things, refactoring things‚Ä¶ And if you think that an LLM can help you - well, you try this. [laughs] And it takes longer to go through those iterations than - if you know what you‚Äôre looking for, it tends to be easier.</p>
<p>Anyway, it‚Äôs very dense, very specific, very difficult to make sure that it‚Äôs doing the right thing. But it‚Äôs all there. We have the mock backends, we‚Äôre reusing things‚Ä¶ We split the VCLs ‚Äì by the way, we finished the splits, so it‚Äôs easier to reuse them. So there‚Äôs quite a few things there.</p>
<p>Now, this is Kaizen, so we are wondering what improved. After all this work, we rolled it out‚Ä¶ What improved? And to answer this question, we need to figure out which region is the busiest one. So out of all the regions that we serve - we have 15 in total - which ones get the most traffic? It‚Äôs those hot regions. We‚Äôre looking at Fly, the Grafana dashboard for our fly application, the instance of the Pipedream, the current one‚Ä¶ And we can see that SJC - San Jose, California - is a nice, big, red circle, which means it has the most traffic‚Ä¶ And also NRT, which is Tokyo.</p>

              </div>


            <div>
              
              <p>Huh.</p>
            </div>


            <div>
              
              <p>Apparently.</p>
            </div>


            <div>
              
              <p>We‚Äôre big in Japan.</p>
            </div>


            <div>
              
              <p>Yeah. And Europe, there‚Äôs quite a few‚Ä¶ So if I‚Äôm going to pull this down a little bit; let‚Äôs see‚Ä¶ No, I wanted to go here.</p>
            </div>


            <div>
              
              <p>What about that new continent? Are we big there?</p>
            </div>


            <div>
              
              <p>The new continent? Australia?</p>
            </div>


            <div>
              
              <p>No, there‚Äôs a new one. There‚Äôs a new-new one.</p>
            </div>


            <div>
              
              <p>Well, what‚Äôs it called?</p>
            </div>


            <div>
              
              <p>Which is the new one?</p>
            </div>


            <div>
              
              <p>I don‚Äôt know. There‚Äôs a headline‚Ä¶ I thought y‚Äôall would get the joke.</p>
            </div>


            <div>
              
              <p>No.</p>
            </div>


            <div>
              
              <p>Over the holiday there was speculation there was a new continent being announced.</p>
            </div>


            <div>
              
              <p>Narnia?</p>
            </div>


            <div>
              
              <p>Maybe‚Ä¶ It could have been Narnia.</p>
            </div>


            <div>
              
              <p>[laughs] No, no, no.</p>
            </div>


            <div>
              
              <p>With the closet.</p>
            </div>


            <div>
              
              <p>So right now, even this list is basically ‚Äì if you think about it, it kind of makes sense. It‚Äôs US East, US West, Europe‚Ä¶ But we have quite a few instances in Europe. We have four. It‚Äôs more geographically spread in Europe. And we have Asia. So these are like the big ones. Australia, Africa, and South America - they‚Äôre not as busy. They are the least busy regions. Cool‚Ä¶ So which instance would you like us to have a look at? So I have a queue right here‚Ä¶</p>
            </div>


            <div>
              
              <p>SJC, baby. Let‚Äôs go. Let‚Äôs go big.</p>
            </div>


            <div>
<p>SJC, baby. Alright, let‚Äôs see that. So I‚Äôm running flyctl, SSH console. I‚Äôm using two flags. -s, which is a short one for ‚Äìselect‚Ä¶ It‚Äôll prompt me which instance I want to select. And then I have -C. Capital C. It‚Äôs different than lowercase c. They do different things. I give it the command to run. And it‚Äôs [unintelligible <a href="#t=00:41:11.25">00:41:11.25</a>] which will give me all the statistics from Varnish at a point in time. So since this instance was running, I will select SJC‚Ä¶ There you go. And it will give me all this data, which is all the counters that Varnish is incrementing, is keeping track of different things; of the origins, backends, the memory pool, the disk pool, the lock counters‚Ä¶ There‚Äôs so much stuff. I‚Äôm really, really impressed how many things Varnish has.</p>
<p>So this is what we‚Äôre going to do. ‚ÄúWe‚Äù, because AI.. We‚Äôre going to copy all of this, we‚Äôre going to ask AI what it thinks of this‚Ä¶ How about that? [laughs] There‚Äôs just too much data here, so let‚Äôs be serious about it. So question to you - which is your favorite AI, Jerod? Which one do you use?</p>

              </div>


            <div>
              
              <p>Oh, I don‚Äôt like any of them. I would probably start with Claude, and then I would go to Grok, and then I would go to ChatGPT, third.</p>
            </div>


            <div>
              
              <p>[<a href="#t=00:42:11.24">00:42:11.24</a>] Okay. So Claude, which one? Which version? Which model?</p>
            </div>


            <div>
              
              <p>Opus, man. Give us the Opus.</p>
            </div>


            <div>
              
              <p>Opus. Okay. So we‚Äôre looking at abacus.ai, something I‚Äôve been using for a long, long time‚Ä¶ It allows you ‚Äì I‚Äôm only paying $10 per month for it. Not sponsored, not affiliated in any way‚Ä¶ It‚Äôs just something that I‚Äôve picked for myself, and I can basically pick any model, and I can just run this. So I have something prepared, so I‚Äôm going to drop this - it‚Äôs all the data - and we‚Äôre going to read through something that I prepared ahead of time.</p>
            </div>


            <div>
              
              <p>You pre-prompted this.</p>
            </div>


            <div>
              
              <p>I pre-prompted this, exactly.</p>
            </div>


            <div>
              
              <p>Okay. You‚Äôve been engineering this prompt for weeks.</p>
            </div>


            <div>
              
              <p>Not really, but‚Ä¶</p>
            </div>


            <div>
              
              <p>Oh, that‚Äôs a long prompt.</p>
            </div>


            <div>
              
              <p>So we‚Äôre going to read it, and in the meantime, Adam will think about his favorite LLM to try. And I have mine. So we‚Äôll try three LLMs to see what they say.</p>
            </div>


            <div>
              
              <p>Oh, my goodness.</p>
            </div>


            <div>
              
              <p>So I‚Äôll need to read the prompt now, while everybody thinks, ‚ÄúNo‚Ä¶! You should be using-‚Äù whatever LLM you should be using. ‚ÄúYou are a Varnish 7 expert. You need to prepare four distinct responses, and be explicit about the person that you‚Äôre addressing. One, a seasoned sysadmin that has been living and breathing infrastructure for the last 20 years. Be precise, think deeply, and approach the setup from a hardware perspective. Two, an Elixir application developer that embraces Erlang‚Äôs ‚ÄúLet it crash‚Äù concept. You need to give it straight, give it fast, and keep it relevant to their application. Use the app and the nightly backends. Assets and fees are important, but less relevant. Cloudflare R2. Three, the business person that is selling this thing. They care about costs, efficiency and simplicity. Keep it high level and relevant for someone that doesn‚Äôt care about the tech, but cares about the outcomes. And four, the audience of a podcast where this is being discussed. Make it general, relatable and fun. Make analogies, keep it light and engaging.‚Äù I have fun too many times. We don‚Äôt wanna make it too fun‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>That‚Äôs a lot of fun.</p>
            </div>


            <div>
              
              <p>Yeah, that‚Äôs one too many funs.</p>
            </div>


            <div>
              
              <p>That‚Äôs right. Well‚Ä¶ [unintelligible <a href="#t=00:44:16.27">00:44:16.27</a>]</p>
            </div>


            <div>
              
              <p>‚ÄúNow that you understand your audience, please analyze the following VarnishStat output for the‚Ä¶ SJC.‚Äù Look, I already knew that you would pick ‚Äì</p>
            </div>


            <div>
              
              <p>How did you know I‚Äôd go for the big one‚Ä¶?</p>
            </div>


            <div>
              
              <p>I have no idea. ‚ÄúFocus on things that work well, things that could be improved, and anything else that you find interesting. And by the way, ignore the synthetic requests.‚Äù It will keep mentioning these‚Ä¶ I get so fed up with this. We have health checks that run every five seconds, so they are normal.</p>
            </div>


            <div>
              
              <p>Okay.</p>
            </div>


            <div>
              
              <p>So I‚Äôm going to copy this, I‚Äôm going to run this, and I‚Äôm also going to open a new window for Adam. So which LLM should we pick, Adam? Which is your favorite?</p>
            </div>


            <div>
              
              <p>You mean model?</p>
            </div>


            <div>
              
              <p>Model, yeah. Which model?</p>
            </div>


            <div>
              
              <p>We just used it‚Ä¶ But I‚Äôd probably back up to like Codex‚Ä¶ Which is like GPT-5, latest‚Ä¶ 5.1, 5.2‚Ä¶</p>
            </div>


            <div>
              
              <p>There you go. So GPT Codex. My favorite one is Gemini, so I‚Äôm going to drop it‚Ä¶ And let‚Äôs see how do they compare.</p>
            </div>


            <div>
              
              <p>Ah, Gemini. You‚Äôre in a different tab now. So Abacus can‚Äôt do Gemini?</p>
            </div>


            <div>
              
              <p>It might, but I have my own Pro account.</p>
            </div>


            <div>
              
              <p>Gotcha.</p>
            </div>


            <div>
              
              <p>So that‚Äôs something else. I use Veo, I use Nano Banana‚Ä¶ Quite a few things. Transcripts‚Ä¶ It‚Äôs all part of the package. So it can, but that‚Äôs what I prefer. Cool. So Claude Opus 4.5, for the seasoned sysadmin.</p>
            </div>


            <div>
              
              <p>This is you, Gerhard.</p>
            </div>


            <div>
              
              <p>This is me, exactly. Thank you for noticing. For knowing who‚Äôs who. [laughs]</p>
            </div>


            <div>
              
              <p>You‚Äôre welcome. I‚Äôm following‚Ä¶</p>
            </div>


            <div>
<p>[<a href="#t=00:45:45.09">00:45:45.09</a>] So what‚Äôs working well? Rock-solid stability. So by the way, the instance has been running for 5.4 days. We had all these improvements shipped, and we are able to observe how our busiest instance works‚Ä¶ And that‚Äôs what this is, basically. That was‚Ä¶ The window moved. Cool. So after 5.4 days, zero child panics crashes, zero thread failures. This is important. It means no threads died, no threads had to be restarted; everything is healthy on this instance. It didn‚Äôt crash. So this instance didn‚Äôt crash.</p>
<p>Zero lock contention across all subsystems. Your CPU cache lines are happy. Excellent hit ratio, 93%. We like that. We really like that. We have backend connection pooling, with a two to one reuse ratio, and memory pressure is minimal. 132 lru‚Äôs in the last five days. Lru nukes. So very few objects had to be removed from memory. Thread pool property - 300 threads, zero queuing, zero drops. That‚Äôs perfect.</p>
<p>Areas to investigate. Disk storage allocator failures‚Ä¶ We have disk C fails‚Ä¶ We are hitting storage fragmentation. The disk is 97% full. We have 48 gigabytes used. That‚Äôs how many MP3 files are stored. By the way, how many MP3 files total do you think we have?</p>

              </div>


            <div>
              
              <p>Size or files?</p>
            </div>


            <div>
              
              <p>Size.</p>
            </div>


            <div>
              
              <p>Size. Well, if we had a thousand episodes at a hundred megs each, which - neither of those things are true‚Ä¶ That‚Äôd be a hundred gigs. So a hundred is too big, but a thousand is too small. I‚Äôm going to say 80 gigs.</p>
            </div>


            <div>
              
              <p>Adam, do you want to guess?</p>
            </div>


            <div>
              
              <p>That math checks out‚Ä¶ I was gonna say like a terabyte, but that‚Äôs probably raw wav files, versus not‚Ä¶</p>
            </div>


            <div>
              
              <p>All the files that we store in R2 - and this includes all the assets; but we know that the MP3 files are the biggest - it‚Äôs close to 250 gigabytes. We may have some duplicates; I don‚Äôt know, I haven‚Äôt checked. But that‚Äôs how much files we have in R2.</p>
            </div>


            <div>
              
              <p>Yeah. Well, we also have Plus Plus for the last couple of years, which means every episode has two files, not just one. So‚Ä¶ That makes sense.</p>
            </div>


            <div>
              
              <p>So we should go higher‚Ä¶ Now, we use this in every single region, so maybe we want to reduce number of regions‚Ä¶ But I think ‚Äì</p>
            </div>


            <div>
              
              <p>We need a third category called ‚ÄúSuper-hot.‚Äù</p>
            </div>


            <div>
              
              <p>Super-hot, yes. Maybe.</p>
            </div>


            <div>
              
              <p>Which is like SJC in Tokyo, right?</p>
            </div>


            <div>
              
              <p>That‚Äôs possible, yeah. There‚Äôs four, which - we know they‚Äôre really, really hot. Yeah, yeah. But honestly, this is happening across multiple regions, and‚Ä¶</p>
            </div>


            <div>
              
              <p>It is.</p>
            </div>


            <div>
              
              <p>‚Ä¶we‚Äôll get to some interesting things. So okay. Synthetic responses, grace hits‚Ä¶ All good. For the Elixir developer - and I think this is you, Jerod. Do you want to read it out?</p>
            </div>


            <div>
              
              <p>Oh. ‚ÄúWell, the TL;DR is Varnish is doing its job. Your app backend is well protected.‚Äù Do you want me to read the whole thing?</p>
            </div>


            <div>
              
              <p>If you want‚Ä¶ I mean, it‚Äôs shielded‚Ä¶</p>
            </div>


            <div>
              
              <p>It‚Äôs 95% shielded. No failures, zero backend failures‚Ä¶ That‚Äôs because of - you know, my code doesn‚Äôt really let it crash very often.</p>
            </div>


            <div>
              
              <p>Exactly. Your code is ‚Äì yeah, it crashes internally, not externally. [laughs]</p>
            </div>


            <div>
              
              <p>That‚Äôs right. My thing is doing its thing. It is generating some uncacheable responses, but you know, we do have some that we just don‚Äôt want to be cached‚Ä¶ Ooh, one fetch failure. Negligible. Yeah, I agree. We don‚Äôt need to worry about that. And in the end, it says ‚ÄúWhoever wrote this is really good at what they do.‚Äù</p>
            </div>


            <div>
              
              <p>I agree. That‚Äôs exactly what it says. [laughs]</p>
            </div>


            <div>
              
              <p>And they should be proud of themselves‚Ä¶ And congratulations on such a great hire.</p>
            </div>


            <div>
              
              <p>Yeah. I agree. I agree.</p>
            </div>


            <div>
              
              <p>[laughs]</p>
            </div>


            <div>
              
              <p>I think the hire needs a promotion, and a bonus, I think‚Ä¶</p>
            </div>


            <div>
              
              <p>There you go.</p>
            </div>


            <div>
              
              <p>Alright. For the business person, the caching layer is performing excellently. Adam, do you recognize yourself? Or shall I continue with this?</p>
            </div>


            <div>
              
              <p>You can read it.</p>
            </div>


            <div>
              
              <p>93% of requests never touch your servers. Massive cost savings on compute. Do you know how many requests per second the application is serving? Maximum, by the way. What‚Äôs the maximum RPS for this amazing Elixir Phoenix application, for the homepage?</p>
            </div>


            <div>
              
              <p>Probably a lot. Gosh‚Ä¶ Thousands? Tens of thousands?</p>
            </div>


            <div>
              
              <p>Maximum. Okay. Jerod?</p>
            </div>


            <div>
              
              <p>100,000?</p>
            </div>


            <div>
              
              <p>The database connection is involved.</p>
            </div>


            <div>
              
              <p>Concurrently?</p>
            </div>


            <div>
              
              <p>Concurrently, yes. I don‚Äôt know, I‚Äôd say not very many. To our homepage?</p>
            </div>


            <div>
              
              <p>[<a href="#t=00:50:15.13">00:50:15.13</a>] The homepage.</p>
            </div>


            <div>
              
              <p>That‚Äôd be like 12. 12 requests a second.</p>
            </div>


            <div>
              
              <p>Yeah. 17. [laughs]</p>
            </div>


            <div>
              
              <p>17! I‚Äôm right in there, baby.</p>
            </div>


            <div>
              
              <p>Someone that knows their code. So 17 requests per second. [laughter] So if all these requests were hitting the application, we‚Äôd need so much compute to serve that. So much caching‚Ä¶ Obviously, we‚Äôve removed all the caching. Now we‚Äôre joking about this, because we purposefully removed all the caching from the application.</p>
            </div>


            <div>
              
              <p>Right.</p>
            </div>


            <div>
<p>I remember that a couple of years back, because we said ‚ÄúThis has no place in the application. The application gets restarted, we need to store this somewhere, we need a cluster‚Ä¶‚Äù It was just really messy to handle it at that layer, which is why we introduced this. Five plus days running without any issues‚Ä¶ By the way, this is the last deploy. So maybe by the next Kaizen, if we do no more deploys, we‚Äôll be able to see how well it handles. Zero failures on the infrastructure side, and three terabytes of data served to users. Three terabytes. So in five days, this one instance served three terabytes.</p>
<p>Without your application servers breaking a sweat, storage is getting full‚Ä¶ So we need basically more storage. For the podcast audience ‚Äì</p>

              </div>


            <div>
              
              <p>Oh yeah, it‚Äôs gonna be fun.</p>
            </div>


            <div>
              
              <p>Imagine a really good receptionist at a busy office. This Varnish server is like having someone at the front desk who remembers everything. Out of 100 people who walk in asking questions, 93 of them get their answers immediately from the receptionist, without ever bothering the experts in the back office. What‚Äôs cool? It‚Äôs been running for over five days straight without a coffee break, or a single mistake. That sounds cruel to me, but let‚Äôs go with it‚Ä¶</p>
            </div>


            <div>
              
              <p>Good job. [laughter]</p>
            </div>


            <div>
              
              <p>It served three terabytes of data‚Ä¶ That‚Äôs like streaming about a thousand HD movies. This one instance streamed a thousand HD movies in five days. And the experts only had to answer 7% of the questions. The one quirk - the filing cabinet is getting full. It‚Äôs like when your receptionist‚Äôs desk drawers are stuffed, and they occasionally have to throw away old notes to make room for new ones. Not a crisis, just time to get a bigger cabinet. Okay, I think the [unintelligible <a href="#t=00:52:29.09">00:52:29.09</a>] 300 workers‚Ä¶ I think that‚Äôs too detailed right there.</p>
            </div>


            <div>
              
              <p>That‚Äôs good fun there. Good job.</p>
            </div>


            <div>
              
              <p>Do we care about GPT, or Gemini? We can only use one. We can only pick one.</p>
            </div>


            <div>
              
              <p>Gemini is getting some good hotness‚Ä¶</p>
            </div>


            <div>
              
              <p>Let‚Äôs check Gemini. We‚Äôll see how it adds up. Oh, it‚Äôs still thinking‚Ä¶</p>
            </div>


            <div>
              
              <p>Let‚Äôs see. I think it‚Äôs finished. Maybe that‚Äôs ‚Äì let me just close that. Did it finish? I think it did. Alright, so let‚Äôs go up‚Ä¶ Slow thinking‚Ä¶ I did the thinking ‚Äì I could have gone Pro as well.</p>
            </div>


            <div>
              
              <p>Show thinking.</p>
            </div>


            <div>
              
              <p>Oh, show thinking.</p>
            </div>


            <div>
              
              <p>Show thinking. Slow think‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>I thought I said ‚ÄúSlow thinking.‚Äù I was like ‚ÄúCome on, speed up, Gemini.‚Äù</p>
            </div>


            <div>
              
              <p>Show thinking. There‚Äôs quite a lot there‚Ä¶ Anyway, we‚Äôre not going to look into that.</p>
            </div>


            <div>
              
              <p>No.</p>
            </div>


            <div>
              
              <p>So the instance has been up for 5.3 days. The MGT uptime - I like it. It‚Äôs telling me which of that long list of counters is important. From a system perspective, the threading model is perfectly dialed in. 300 threads across two pools, with a zero thread limited, and zero thread queue length. The kernel isn‚Äôt context-switching unnecessarily, and we aren‚Äôt starring for execution units. However, we have a critical IO and storage allocation bottleneck in the SMF. The file - I‚Äôm not sure what Steve Dore means. That‚Äôs a weird one‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>I‚Äôm not sure Gemini knows what Steve Dore means either.</p>
            </div>


            <div>
<p>[<a href="#t=00:53:51.06">00:53:51.06</a>] The problem is SMF disk C fail is at 19,000 plus, against only requests at a 73% failure rate for disk allocations. In the G space we have only 145 megabytes, while we have 48 gigabytes used. ‚ÄúYou‚Äôre effectively out of contiguous blocks or hitting the ceiling of the pre-allocated file.‚Äù That sounds right. Varnish is forced to fall back to SMA RAM or simply not cache large objects. While SMA has 2.1 gigabytes free, the disk is thrashing. The hardware, ‚ÄúIf this is spinning glass, your IO8 is likely spinning.‚Äù It‚Äôs not; it‚Äôs NVME. So yeah, there‚Äôs quite a few things there. Interesting is low, relative ‚Äì suggesting the lock contention on the shared memory log is negligible. Nice. We have low lock contention. The bottleneck is strictly at the storage layer. We just need basically a bigger disk.</p>
<p>The Elixir developer - let it crash proponent. I like it. Your app backend is rock solid. Well done, Jerod. Varnish hasn‚Äôt seen a single backend fail or an unhealthy event in five days. The let it crash philosophy is working. If the app is crashing, it‚Äôs recovering. So far, Varnish doesn‚Äôt even notice. I don‚Äôt think it is‚Ä¶ I think the application is good. The good news is we‚Äôre seeing an effective 75% hit rate. Now, this is different, right? We had 93% there, so I would like to understand the discrepancy. That‚Äôs another reason why you should use more than one, by the way. And then obviously, double-check the data, because sometimes they give you things which aren‚Äôt true‚Ä¶ The crash concern - the disk cache is crashing. Again, this is not for the application developer. I think this is for the sysadmin in me, I think. The straight talk‚Ä¶ Your main synth is high. So we have health checks. There‚Äôs delta responses‚Ä¶ So we have a lot of synthetic requests. Sorry, synthetic responses. This is, again, a Varnish thing.</p>
<p>The business person - efficiency we‚Äôre currently serving of our traffic from Varnish‚Ä¶ I think I know what‚Äôs happened. I don‚Äôt think it‚Äôs taking into account the synthetic requests. Those should be removed from the total number of requests.</p>

              </div>


            <div>
              
              <p>So you think Claude has the right number?</p>
            </div>


            <div>
              
              <p>I think so, yeah. Yeah, I think so. This means for customers - we have cost efficiency, that‚Äôs good. The risk‚Ä¶ There‚Äôs the bottom line. I think this was the fun, but I think this is a library. I think we can stop it here.</p>
            </div>


            <div>
              
              <p>The library analogy versus the secretary analogy.</p>
            </div>


            <div>
              
              <p>I think that was a better one. I got a barista one, I thought it was a very good one‚Ä¶</p>
            </div>


            <div>
              
              <p>Oh, yeah‚Ä¶ For queuing, or for what?</p>
            </div>


            <div>
              
              <p>For queuing, yeah. The barista analogy I thought was very good. This is using books, and whatnot. The library hasn‚Äôt burned down‚Ä¶ That is fun. [laughs]</p>
            </div>


            <div>
              
              <p>Oh, that‚Äôs a good thing.</p>
            </div>


            <div>
<p>That is fun. So I think Gemini is getting a bit funnier. The nightly feeds in the app are still humming along. Nice. So that‚Äôs what we have‚Ä¶ And that was only half the problem.</p>
<p><strong>Break</strong>: [<a href="#t=00:56:53.09">00:56:53.09</a>]</p>

              </div>


            <div>
              
              <p>That was only half the problem. So we‚Äôre at the midpoint‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>Oh‚Ä¶ I was feeling good. I felt like we had it all fixed. What else is the problem?</p>
            </div>


            <div>
              
              <p>Oh, man‚Ä¶ This is when all the fun begins. So. Do you remember this, Jerod?</p>
            </div>


            <div>
              
              <p>Yes. MP3 requests intermittently hang in Newark, New Jersey. This was our good friend, John Spurlock, who‚Äôs been on the show before, and is a podcast nerd‚Ä¶ In fact, he runs op3.dev and other podcast nerdery things. And so he really knows his stuff. And so when he reports issues, I don‚Äôt say ‚ÄúDid you try rebooting?‚Äù I take it seriously. So I shared it with you‚Ä¶ And he actually did some additional digging for us. Go ahead.</p>
            </div>


            <div>
              
              <p>Mm-hm. So in terms of - you tested this, and I think you had issues as well. So we‚Äôve confirmed this, for sure.</p>
            </div>


            <div>
              
              <p>I did. Certain times, certain files‚Ä¶ Actually, it would be all requests at certain times. I assume that it was that particular pop - as we could call them; or pipe, in the Pipe Dream - was hanging. And then it would go away‚Ä¶ And he actually had the same problem. He had a Friday night deploy of Friends, and he was trying to listen to it on Friday. Couldn‚Äôt get to it. By Saturday morning he can get to it. So it‚Äôs intermittent hanging. Very difficult to diagnose, very difficult - I assume - to debug. And then it just comes back to normal‚Ä¶ I thought it was maybe the out of memory thing; like, it‚Äôs just in some sort of fugue state until it reboots, and then it works again‚Ä¶ But you go ahead.</p>
            </div>


            <div>
<p>That‚Äôs what I thought. That‚Äôs why I did a deep dive on this. This was November, end of November, beginning of November‚Ä¶ So November, I was just trying to figure out what on Earth was going on. Just from the sides‚Ä¶ I didn‚Äôt have too much time. But if you look at this response, there‚Äôs quite a few things there. This is my initial one, an investigation, trying to understand what‚Äôs happening, giving a couple of debug headers, a couple of extra headers that the request can be made of ‚Äì sorry, can be run with, so we‚Äôd just get a bit more details. Forcing regions as well‚Ä¶ So there‚Äôs quite a few things there; I was checking into that.</p>
<p>This is Don McKinnon. He also had issues today, so he pasted some results‚Ä¶ So thank you. Thank you, Don, for adding this. This was helpful. So I‚Äôm still scrolling, I‚Äôm still scrolling‚Ä¶ There we go. Super-helpful. I have confirmed that the requests have been hanging‚Ä¶ You are getting the hangs this afternoon as well. This was only three weeks ago‚Ä¶ So this has been going on for a while. I dug deeper and I‚Äôve found the problem. The problem was that in the Fly config we had the concurrency set to connections, not requests. So it‚Äôs possible to configure an application. Again, you‚Äôre configuring the Fly proxy that sits in front of the application to limit how much traffic hits your application. So requests - how many requests per second should the Fly proxy forward to your application before it stops? Because you don‚Äôt want to get overloaded. So before it starts throttling, it starts slowing clients down‚Ä¶ And that‚Äôs when you start seeing Fly edge errors.</p>
<p>[<a href="#t=01:02:09.02">01:02:09.02</a>] Connections, you would use for something that has long-running connections, like a database, for example. In our case, it‚Äôs not a database, it‚Äôs an HTTP application‚Ä¶ So requests would have been the right concurrency. I have no idea why I picked connections. It was the wrong one. But the effect was, as you can see here, we had 2,700 long-running connections on that edge, so on that region. So in this case it was, I think, the orange one‚Ä¶ I think EWR, right? So EWR had all these connections opened. The clients were enclosing the connection, the proxy was full, no more connections could be forwarded to the application.</p>
<p>Long-running connections - there are usually clients which are not doing the right thing. You shouldn‚Äôt have that many long-running connections. So the problem was a misconfiguration on our side, which meant that connections, like slow connections, long-running connections were basically blocking other connections from coming through. So that was the problem there.</p>
<p>And I thought that was it, but‚Ä¶ But‚Ä¶ There was more. So there was a last comment, last week‚Ä¶ We now have a check that runs every hour, and what was interesting - and I‚Äôll talk about the check as well - we had response bodies timing out in two regions. So 13 regions were fine, but even after this configuration, there were two regions - IADT and EWR - where when we were using HTTP2, and for some reason this is important‚Ä¶ When we were using HTTP2 and the Fly proxy would see this, it would not forward the connection correctly. As in it would start, it would serve the response, we could see the headers coming back from our instances; what we wouldn‚Äôt get is the body. So the body would always be like ‚ÄúZero bytes served.‚Äù And we could see this happening, we could see the connections that, by the way, they were opened‚Ä¶ They shouldn‚Äôt have been opened, because the application changed, so these connections should have been dropped‚Ä¶ There was something not quite right. My suspicion is with the Fly proxy layer. Because when we were forcing HTTP1, everything was working fine. And by the way, the Fly proxy, when it talks to our Varnish instance, it‚Äôs using HTTP1. And you can see that in the headers.</p>
<p>So the proxy to the Varnish was fine, but the client to the proxy was not fine. And HTTP 2.0 is a very complex protocol. There‚Äôs so many things which just don‚Äôt work the way people would expect. So anyway, the issue fixed itself‚Ä¶ That‚Äôs the important thing. [laughs] So opening this ‚Äì</p>

              </div>


            <div>
              
              <p>Not super-satisfying‚Ä¶</p>
            </div>


            <div>
              
              <p>Yeah, that was very nice to see. And there was something ‚Äì Maya Ilaros? How would you read this‚Ä¶?</p>
            </div>


            <div>
              
              <p>Maya Ilaros.</p>
            </div>


            <div>
<p>Ilaros, there you go. Someone on the Fly community forum that was very helpful - they noticed that we had a misconfiguration in our Fly TOML. And we were using services, as well as HTTP service, and this is bad, by the way. This is very, very bad. So everything was happy; we could push this config, the applications were running, everything was fine‚Ä¶ But because we had these two things together, it was apparently creating some issues. And all we did - we were explicitly setting the idle timeout. And the idle timeout - that‚Äôs the one where if after 60 seconds the connection isn‚Äôt doing anything, it will be forcefully terminated by the proxy. So that part was important.</p>
<p>So anyway, we made the change, we pushed the change‚Ä¶ But even before we pushed the change, the proxy started behaving, and now there‚Äôs pull request 49 - we right-sized it, we made a few changes, I captured all the details, the configuration, the commands‚Ä¶ It‚Äôs all there if you want to read it. But most importantly, now we have a check that runs against all regions, every hour, on the hour. CI/CD, it‚Äôs using Hurl‚Ä¶ And what I‚Äôm thinking is, shall we try running that locally, to see how it behaves? Because that‚Äôs how we started it. I was starting to do it locally.</p>

              </div>


            


            <div>
<p>So on the left-hand side ‚Äì I‚Äôm back in the terminal. On the left-hand side I am monitoring my internet connection. Remember that Christmas tree? This is related to that Christmas tree. So I‚Äôm at the top of the Christmas tree, I‚Äôm at the gateway, the core router. It‚Äôs a MikroTik CR2004. Pretty good‚Ä¶ 10 gigabits per second, maximum. Now, my internet connection isn‚Äôt 10 gigabits, it‚Äôs 2.5, which is plenty for this test. So every second it‚Äôs showing me how many packets and how many bits we‚Äôre receiving and transmitting. And again, we are recording, everything‚Äôs happening live, so you can see it jumping as we‚Äôre pushing more data to Riverside.</p>
<p>Cool. So I‚Äôm going to run now Justcheck. And justcheck, by default - it‚Äôs one of the commands, the just command that we have in the Pipely repository. And check - all it does, it runs Hurl with a couple of flags. It downloads an MP3 file, it downloads feeds‚Ä¶ It basically connects to all the different backends, and it sees how quickly it can get data back. We‚Äôre transferring about ‚Äì that was quick, that was eight seconds. I‚Äôm going to run it again, and as I run this, pay attention to the left-hand side‚Ä¶ It will go to 120 megabits per second. So that‚Äôs that MP3 file being downloaded. So every single time this runs, a full MP3 file gets downloaded, alongside a few other things.</p>
<p>Okay, I can open the reports‚Ä¶ We‚Äôre not going to look into that, because we‚Äôre going to run something more interesting now. We‚Äôll do Check All. And what Check All does - it runs the same command against all the regions. I‚Äôm at 2.3 gigabits per second. We‚Äôre downloading all the files‚Ä¶ We can see the response is coming back. EWR just sped by, [unintelligible <a href="#t=01:08:18.24">01:08:18.24</a>] sped by‚Ä¶ So all the different endpoints are returning. Now, I‚Äôm based in London‚Ä¶ Obviously, the further away you are ‚Äì so for example, this was South America, that was LAX‚Ä¶ So a couple of instances are slower to respond. And all this happens via headers. When you connect to Fly, you can tell it ‚ÄúHey, I want to connect to a specific region‚Äù, and then that‚Äôs what routes the request to that region.</p>

              </div>


            <div>
              
              <p>That‚Äôs cool.</p>
            </div>


            <div>
<p>And again, it‚Äôs all captured in that pull request, and you can see what it looks like. The Check All one - Johannesburg, that‚Äôs usually slow. And the slowest one is Tokyo for me. Sydney as well can be slow. So we still haven‚Äôt received the responses from there. We should get that shortly. I‚Äôm pulling now 50 megabits, 20 megabits‚Ä¶ It‚Äôs just slowing down. And it‚Äôs just ‚Äì the connections between now and there‚Ä¶ The last one there was Tokyo.</p>
<p>In 60 seconds I pulled about two gigs, roughly. It‚Äôs a lot of data that gets pulled down. The feeds, between all of that. And anyone can run it. I would recommend you not to run this, because we have to pay for this bandwidth‚Ä¶ But our CI runs it, just to make sure that everything works. And if we look at every hour - I think I‚Äôm going to tune this down. You can see there were no more connections hanging. So we got to the bottom of that as well.</p>

              </div>


            <div>
              
              <p>If it ever comes back ‚Äì because it went away on its own. If it comes back on its own, we‚Äôre worried about it.</p>
            </div>


            <div>
              
              <p>Exactly. Now we have a system that is able to inform us when there‚Äôs a problem. So let‚Äôs go to three‚Ä¶ We‚Äôre on page number three. This one, for example, took more than five minutes. So sometimes, when the connectivity is a bit slow, some regions can be slow - that‚Äôs when you get these timeouts. So this is capped at five minutes‚Ä¶ The last one that failed was a while ago. So you can see we‚Äôre January 5th‚Ä¶ There we go. There‚Äôs one that failed January 4th. Check all instances‚Ä¶ So let‚Äôs see Run, and we‚Äôll see exactly which region failed. Execution‚Ä¶ NRT, that‚Äôs Tokyo, and as you can see, we have 100 seconds. So if after 100 seconds it doesn‚Äôt download, it just times out. And we were pulling data, but it didn‚Äôt finish downloading the entire MP3. And we‚Äôre downloading 100 and something megabytes.</p>
            </div>


            <div>
              
              <p>[<a href="#t=01:10:34.02">01:10:34.02</a>] Very cool. I mean, not cool that it didn‚Äôt finish, but cool that that was a while ago, and we can actually test this. Now, do we need to be doing such a large file? Is that part of the test? Or can we test a smaller file, and still get the same results?</p>
            </div>


            <div>
              
              <p>We could, yes. This was a file that was reported. So we need to find an MP3 file, absolutely. I think we can also reduce the frequency. We don‚Äôt have to run it every hour. This was obviously in preparation for this conversation‚Ä¶</p>
            </div>


            <div>
              
              <p>What about episode 456?</p>
            </div>


            <div>
              
              <p>That‚Äôs coming up. That‚Äôs coming up. That‚Äôs the deepest rabbit hole, so I‚Äôm leaving that for last. That‚Äôs coming, Adam‚Ä¶ [laughs]</p>
            </div>


            <div>
              
              <p>One thing I suggested though in our Zulip - and I didn‚Äôt check to see if this is even a thing, but‚Ä¶ To validate - you know, if the Fly CLI could validate the TOML file for you. Because you could have checked the TOML file for syntax errors, or just do‚Äôs and don‚Äôts, essentially‚Ä¶ And it didn‚Äôt.</p>
            </div>


            <div>
              
              <p>It does have a validation subcommand. Syntactically, it‚Äôs correct. The config is valid. I mean, it was applied‚Ä¶ But because it combines two things, it shouldn‚Äôt. So at least I would expect a warning, like ‚ÄúHey, you‚Äôre using both HTTP services.‚Äù</p>
            </div>


            <div>
              
              <p>That‚Äôs right. Yeah, validate syntax, and then validate expected, true TOML file config. Don‚Äôt combine or conflate two values, or overwrite one, or‚Ä¶ You know, just that kind of thing. That‚Äôs how I would defensively do something like that in a CLI to protect my user from a poor config. They could have just not been holding it wrong for so long.</p>
            </div>


            <div>
<p>Yup. I agree. So it‚Äôs the impact of that configuration, indeed. Yup. So this is something ‚Äì we can see, again, the same logs. We can see ‚Äì this one here goes to 50 megabytes per second. That‚Äôs 500 megabits. When we have these peaks, when we see this in the Fly config, we can see this usually when the benchmarks run, or when the checks run, because they put significant pressure on the instances, and we can see them, and we can pick them up straight away. So that‚Äôs what this is.</p>
<p>Alright‚Ä¶ So remember this guy - this guy was saying March 29th. So it‚Äôs almost two years ago when this guy was saying ‚ÄúWe will run into all sorts of issues that we end up sinking all kinds of time into.‚Äù So this guy had a good hunch. This is Jerod, March 29th‚Ä¶ [laughter] And we just went through a couple of examples of issues that we had to deal with, part of this. But because of this, we understand the traffic, and we understand how the application behaves, and the backends behave, at a very deep level. So you were right, Jerod. We did sunk all sorts of ‚Äì how many lines? Let‚Äôs see, how many lines do we have now?</p>

              </div>


            <div>
              
              <p>I wanted 20 lines‚Ä¶</p>
            </div>


            <div>
              
              <p>590 lines. [laughs] 590 lines we have in total, of Varnish config. It‚Äôs more than 20 lines. By the way, we have the roadmap to 2.0‚Ä¶ This is 1.0 that we tagged and shipped. It solved a lot of issues. But that was the easy stuff, okay? So for everyone that stuck with us, something really good is coming up.</p>
            </div>


            <div>
              
              <p>It‚Äôs starting to get harder from here.</p>
            </div>


            <div>
              
              <p>[<a href="#t=01:14:02.07">01:14:02.07</a>] And Adam was already mentioning it‚Ä¶ Episode 456. There‚Äôs something special about episode 456.</p>
            </div>


            <div>
              
              <p>Oh, yeah.</p>
            </div>


            <div>
              
              <p>So what is special about it? What stands out to you, Jerod?</p>
            </div>


            <div>
              
              <p>Oh, it‚Äôs just getting rocked with downloads.</p>
            </div>


            <div>
              
              <p>So episode 456, ‚ÄúOAuth, it‚Äôs complicated‚Äù‚Ä¶ And by the way, this was recorded in 2021, it was published, again, August 2021‚Ä¶ For some reason, it‚Äôs been downloaded a lot in recent months. It has over one million downloads. This is the most popular episode on the Changelog, ever.</p>
            </div>


            <div>
              
              <p>The most downloaded episode‚Ä¶</p>
            </div>


            <div>
              
              <p>It‚Äôs crazy. It‚Äôs crazy.</p>
            </div>


            <div>
              
              <p>Oh, so you guys looked into this?</p>
            </div>


            <div>
              
              <p>We did, yes. We dug into this.</p>
            </div>


            <div>
              
              <p>Okay. I didn‚Äôt know you guys were doing this.</p>
            </div>


            <div>
              
              <p>So we just had a quick look to understand what is happening here‚Ä¶ So we have Honeycomb open up, remember, every single request which comes through the Pipe Dream, through Pipely. Every single request we sent to Honeycomb, we were able to look at it‚Ä¶ This is the last 60 days, and I have filtering done in such a way so that I‚Äôm only looking at this one file. How many times has this file been downloaded in the last two months? You can see the peaks, right? You can see ‚Äì and by the way, this is gigabytes, and the period is four hours. So we are peaking at about a hundred ‚Äì actually, this peak was here. We had almost 300‚Ä¶ 300? 400? Anyway, close to 400 gigabytes in a four-hour period.</p>
            </div>


            <div>
              
              <p>That‚Äôs just too much.</p>
            </div>


            <div>
              
              <p>I think so‚Ä¶ I know this is a great episode, great conversation, but ‚Äì</p>
            </div>


            <div>
              
              <p>I remember that conversation. It was good.</p>
            </div>


            <div>
              
              <p>Like, who is downloading this file 400 times - or actually more than 400 times - every four hours, consistently, for months on end?</p>
            </div>


            <div>
              
              <p>Super-fan.</p>
            </div>


            <div>
              
              <p>A super-fan. So we can see the different regions‚Ä¶ Now, this is spread across the entire world. It‚Äôs not just one region. This is really, really big. I think if there was a DDoS attack, I think this would class as one. And in the last six months ‚Äì sorry, in the last two months, 60 days, we served 30 terabytes in San Jose, California alone. In Tokyo, we served 515 terabytes. This is a big number. And if you look in this column, the distinct IPs, the client IPs, we had over 10,000 IPs downloading this file. So this is not one or two IPs, this is thousands and thousands of IPs which keep downloading this file over and over and over again. So I don‚Äôt know how we would block 10,000 IPs‚Ä¶</p>
            </div>


            <div>
              
              <p>Right.</p>
            </div>


            <div>
              
              <p>The VCL would be crazy.</p>
            </div>


            <div>
              
              <p>Well, that episode was starring Aaron Parecki, who is a very talented person. And he is the co-founder of IndieWebCamp, and a big fan of the IndieWeb, as well as OAuth, obviously‚Ä¶ So my hunch is Aaron‚Äôs very interested in being the most downloaded episode ever, and he controls a fleet of machines from all around the world‚Ä¶ And he points them wherever he wishes. And he thinks ‚ÄúYou know what I‚Äôm going to do? I‚Äôm going to get the number one spot on these guys‚Äô download charts.‚Äù And so I‚Äôm thinking Aaron Parecki is the man with the mask on, and we pulled the mask off. It was him this whole time. What do you think, Gerhard?</p>
            </div>


            <div>
              
              <p>I think that we need to speak ‚Äì see, I don‚Äôt want to say the specific language‚Ä¶ I think we need to go to Asia. I think we need to visit a couple of cities in Asia‚Ä¶ [laughter] And find the IPs which are responsible for this, because this is a crazy amount of traffic. Asia, it just so happens, if we look at ‚Äì so Asia is basically the continent where we are getting the most downloads from, because of this one episode. And this is actually traffic being served; this is not like head requests, or get requests. These are bytes being sent to thousands and thousands of machines in Asia, every single hour. So whoever is doing this, please stop. Please. [laughter]</p>
            </div>


            <div>
              
              <p>It‚Äôs on a cycle.</p>
            </div>


            <div>
              
              <p>[<a href="#t=01:18:13.11">01:18:13.11</a>] So we need to knock on doors. We need to go over there and knock on some doors, and say ‚ÄúExcuse me, is this IP address at this home?‚Äù And then they might say yes, and say ‚ÄúWould you please stop? What‚Äôs going on over here?‚Äù What could they possibly benefit from this? What could they be getting?</p>
            </div>


            <div>
              
              <p>Maybe - maybe - we‚Äôre the speed test. [laughter] Someone is using us to speed-test their connection. Who knows?</p>
            </div>


            <div>
              
              <p>Yeah, maybe.</p>
            </div>


            <div>
              
              <p>That‚Äôs the only thing I can imagine.</p>
            </div>


            <div>
              
              <p>Well, that‚Äôs a lot of IP addresses.</p>
            </div>


            <div>
              
              <p>It is.</p>
            </div>


            <div>
              
              <p>And it‚Äôs across multiple regions, which‚Ä¶</p>
            </div>


            <div>
              
              <p>Multiple data centers, yes. So multiple regions, Fly regions are serving these IPs, yes. They‚Äôre all coming from Asia, by the way‚Ä¶ Again, I don‚Äôt want to mention any names, because there‚Äôs no bad guys here, right? We just want to assume that someone left the oven on‚Ä¶</p>
            </div>


            <div>
              
              <p>I don‚Äôt know, man‚Ä¶</p>
            </div>


            <div>
              
              <p>It‚Äôs like the blinker on when you‚Äôre driving. I would say ‚ÄúHey, you‚Äôre not turning. It‚Äôs time to turn that blinker off.‚Äù</p>
            </div>


            <div>
<p>So the way I can see us mitigating this - and this is a hard problem because of the number of IPs which are hitting us. We can basically start blocking entire net blocks, entire network blocks‚Ä¶ Unfortunately, some genuine listeners might be caught in this, and basically, Changelog will not be available, or at least the MP3s will not be available to a portion of users.</p>
<p>The other one is - obviously, we can, and we should‚Ä¶ This is like the next problem. We should enable some throttling, because there‚Äôs more stuff happening here. So we don‚Äôt have any sort of throttling. We assume fairness, we‚Äôre assuming goodwill, we‚Äôre assuming decency, and we‚Äôre not seeing that here.</p>

              </div>


            <div>
              
              <p>Well, that‚Äôs the internet.</p>
            </div>


            <div>
              
              <p>So to be honest, whoever is doing this - and it‚Äôs not LLMs, I had a look; we have that problem as well, but in this case it‚Äôs not LLMs. This is something completely different. So my hope is by someone that listens to this episode - maybe we put this in the intro - whoever‚Äôs downloading episode 456, please stop. Because we‚Äôll need to take the next step‚Ä¶</p>
            </div>


            <div>
              
              <p>I‚Äôm not sure that‚Äôs ‚Äì</p>
            </div>


            <div>
              
              <p>I know it‚Äôs a bit of a cat and a mouse game, but that‚Äôs what will need to happen. Because we need to pay for this bandwidth.</p>
            </div>


            <div>
              
              <p>This is only Varnish, right? This is only the cache layer this is happening.</p>
            </div>


            <div>
              
              <p>This is only the cache layer, yes. Yeah.</p>
            </div>


            <div>
              
              <p>And so what mechanisms are in Varnish to do throttling, or rate limiting, or just anything like that whatsoever?</p>
            </div>


            <div>
              
              <p>There‚Äôs VMods, which are basically modules that Varnish loads, that just give it extra functionality. One such VMod - and I‚Äôve looked at this, it is free and open source - is the VMod throttle. Now, that means that we need to start keeping track of IPs, and it will use a bit more memory‚Ä¶ That‚Äôs okay, we have more memory. And then we need to start basically applying limits to how many download specific IPs can do. And we can limit it to MP3 files only. So if we have a bot, or if we have, for example, an RSS aggregator or something like that, we‚Äôre okay serving those requests‚Ä¶ Because again, that‚Äôs what Varnish is meant to do. The problem here is that we‚Äôre serving a lot of bytes for MP3s, the same MP3 that cannot be real traffic.</p>
            </div>


            <div>
              
              <p>Yeah. I mean, even in this case, you can tie it potentially just to this MP3, like you just said, which is not at all an MP3 scenario. Like, if you request this MP3 with this kind of request signature of X per whatever‚Ä¶ I mean, I didn‚Äôt examine the actual signature of the request, but that‚Äôs how I‚Äôd probably investigate it‚Ä¶ It‚Äôs to begin to isolate. Does that require us to write a lot of defensive code against that kind of scenario?</p>
            </div>


            <div>
<p>I don‚Äôt think so. It‚Äôs just system integration. We just need to add more configuration. And back to Jerod‚Äôs point, we‚Äôre just chasing now new problems that we didn‚Äôt even think we would have‚Ä¶ But we have what looks to me like an actor that‚Äôs not very - I wanna say this in a nice way‚Ä¶ An unfriendly actor, that is not very happy, and they are very angrily downloading our mp3 over and over and over again, thousands of times, across thousands of IPs‚Ä¶ And this is not cool. Because ultimately, we end up paying for this bandwidth. That is not helping anyone.</p>
<p>[<a href="#t=01:22:23.19">01:22:23.19</a>] But that‚Äôs one. It‚Äôs not the only one. We have one more. So you can see here, for example - this is the last seven days; we have seven terabytes that were transferred in the last seven days. Seven terabytes? Maybe that‚Äôs more than that. It needs to be more‚Ä¶ The geocode does not exist. Okay, I was expecting to see more than that. Anyway, Asia is the one that we can see that pattern, but we also have in Europe, sometimes we have these spikes. And this spike, which I wanted to focus on - we know that someone in Frankfurt, that connects to Frankfurt, downloaded the static favicon 170,000 times in the span of, I don‚Äôt know, an hour or two. So they downloaded this like two, three hours. So we get requests like this, that are putting stress on these instances. I mean, what potentially ‚Äì and that was a past request as well, which means it went through the cache, which means that they must have had a cookie set up, or something like that, that basically was preventing the cache from working, in this case‚Ä¶ Which - again, that‚Äôs how it‚Äôs supposed to work.</p>
<p>So anyway, I think that was, unfortunately, not the best thing that we could have ended on, but it‚Äôs a thing, and it‚Äôs something - food for thought. More work to be done. There‚Äôs many things that we didn‚Äôt get to talk to, we didn‚Äôt have time for‚Ä¶ For example, we didn‚Äôt talk about the Nightly‚Ä¶ By the way, Nightly now is being served by the Pipe Dream as well. And the reason why we had to do this is because that sometimes will get scraped, it would get hit really heavily‚Ä¶ It‚Äôs a very small app, it‚Äôs NGINX, but if I open it ‚Äì so let‚Äôs just click on that one. That‚Äôs pull request 46. Before, it was basically topping up at 141 requests per second. Now it‚Äôs at 1,300, so it‚Äôs almost a 10X, an order of magnitude faster. The latency went way, way down‚Ä¶ And the only thing we had to do is basically put Varnish in front of it.</p>

              </div>


            <div>
              
              <p>Nice. Well, that‚Äôs nice.</p>
            </div>


            <div>
              
              <p>Yeah, that‚Äôs one more thing there, and you can go and have a look how it works‚Ä¶ It‚Äôd be like a benchmark here, a small benchmark here‚Ä¶ And that‚Äôs it. We have the last one for the road - but before we do that, anything else you want to talk about before I share one last thought?</p>
            </div>


            <div>
              
              <p>I suppose what do we do, if we know these downloads are happening? ‚Ä¶we‚Äôre here on the podcast, just politely asking to stop‚Ä¶ We just let it keep happening?</p>
            </div>


            <div>
              
              <p>Well, we could set up some sort of throttling‚Ä¶ I think it would be the easiest thing. Now, it will impact everyone‚Ä¶ I don‚Äôt want to start blocking, again, IP ranges, net blocks, because we don‚Äôt know who‚Äôs going to be caught there. They may change to other IP blocks. That‚Äôs entirely possible. We don‚Äôt know how this will work. We can‚Äôt block an entire country, an entire continent, especially if it‚Äôs a big one‚Ä¶ I don‚Äôt think that‚Äôs reasonable. So really, throttling is I think the fairest thing. And then we can throttle MP3 specifically. Because we do have, for example ‚Äì I see them; for example, we have a Python client and a Go client, that every week they come and they download all our MP3s. I don‚Äôt know why they do that, but every seven days, they basically request every single MP3 that we have. So they‚Äôre scraping the website, and then pulling everything down. I don‚Äôt know why.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>[<a href="#t=01:25:49.11">01:25:49.11</a>] Again, the more I was looking at ‚Äì and again, because I was working so deep in this, I started noticing these behaviors that you would normally not see‚Ä¶ So it‚Äôs one of the advantages, I suppose, to working so close with the traffic, with all the requests, and having this level of understanding and visibility into every single request. So it really helps, down to the IP level.</p>
            </div>


            <div>
              
              <p>Something like that though, like the Go client and the Python client - would that be a Honeycomb thing? Where would that be ‚Äì</p>
            </div>


            <div>
<p>Yeah. It‚Äôs Honeycomb, yeah. You can filter by user agent, for example, and you can see that there‚Äôll be‚Ä¶ For example, say ‚Äì no, I don‚Äôt want to show any IPs or anything like that, so that‚Äôs why I‚Äôm not going to screen-share that‚Ä¶ But once we start digging into that, you can say ‚ÄúGroup by client, by agent‚Äù, and you can say ‚ÄúFilter by MP3s.‚Äù So like ‚ÄúURL contains MP3.‚Äù And that will be able to group‚Ä¶ And you can say ‚ÄúOh, and by the way, only show me where there‚Äôs more than, for example, 100 downloads.‚Äù And then you‚Äôll start seeing the outliers, which are the clients that are downloading certain MP3s, or MP3s in general, excessively.</p>
<p>Now, that can be spoofed. That‚Äôs the other thing. We have, for example ‚Äì the request agent, like the user agent, it‚Äôs empty; it‚Äôs an empty string. That also happens. Because you don‚Äôt have to send the header if you don‚Äôt want to.</p>

              </div>


            <div>
              
              <p>Yeah, you can also send whatever you want to, if you want to.</p>
            </div>


            <div>
              
              <p>So that can be spoofed.</p>
            </div>


            <div>
              
              <p>Yeah. It‚Äôs like, whenever you build systems like this, and then even when you observe them - I guess you don‚Äôt expect, that‚Äôs why I originally thought, but you kind of hope that clients, a.k.a. people, behave. They‚Äôre going to use the system for the system‚Äôs purpose, not to once a week download and scrape the entire thing, and‚Ä¶ I mean, in that case, somebody could have their own web archiver, and they could have altruistic reasons for it. I think that‚Äôs kind of silly, but you know, once per week download the entire contents on somebody‚Äôs disk seems like ‚ÄúI want your thing. And I want to keep getting your thing. And if it ever changes, I want to make sure I have that snapshot.‚Äù I don‚Äôt understand it. It doesn‚Äôt make any sense. What would make anybody do that? What is the purpose and motivation to keep doing that? ‚Ä¶to even commit the compute, or the script, or the time to do that? What are they getting from it? I don‚Äôt know.</p>
            </div>


            <div>
              
              <p>We need to go over there and knock on some doors, man, and ask them. ‚ÄúWhy are you doing his‚Ä¶?!‚Äù</p>
            </div>


            <div>
              
              <p>‚ÄúWhat‚Äôs up with that?‚Äù</p>
            </div>


            <div>
              
              <p>Every door‚Ä¶</p>
            </div>


            <div>
              
              <p>‚ÄúWhat‚Äôs in it for you?‚Äù</p>
            </div>


            <div>
              
              <p>‚Ä¶in Asia. ‚ÄúDo you listen to the Changelog?‚Äù ‚ÄúYes, I do.‚Äù ‚ÄúHow many times?!‚Äù</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>‚ÄúTell us about 456. You know what 456 means, don‚Äôt you?!‚Äù [laughter]</p>
            </div>


            <div>
              
              <p>Yeah. So this is, I think, a really delicate and a really important point to discuss‚Ä¶ Because this is how good systems become bad systems.</p>
            </div>


            <div>
              
              <p>It‚Äôs true. Yeah. You have to treat everybody bad‚Ä¶</p>
            </div>


            <div>
              
              <p>Exactly. We don‚Äôt want to be doing this, but we are forced to do something against something which isn‚Äôt good‚Ä¶ So it‚Äôs not benefiting anyone, and we have to step in and do something about it. Now, we have to do it‚Ä¶ I was expecting this to stop, but it‚Äôs still even to this day. We made Varnish ‚Äì I mean, now that it‚Äôs stable, it‚Äôs able to serve more traffic‚Ä¶ We just had the biggest spike, because now the system is more stable, but it means that bad actors ‚Äì again, I shouldn‚Äôt be using that. Unhappy people, unhappy clients‚Ä¶</p>
            </div>


            <div>
              
              <p>Use it‚Ä¶! Who are you gonna offend? The only person you can offend is the one who‚Äôs doing this, and I‚Äôm fine with it.</p>
            </div>


            <div>
              
              <p>Yeah.</p>
            </div>


            <div>
              
              <p>[<a href="#t=01:29:34.18">01:29:34.18</a>] They need to knock it off. Here‚Äôs a ‚Äì this might be a cudgel‚Ä¶ But if we‚Äôre trying to solve the problem of ‚ÄúThey‚Äôre taking our bandwidth for something that‚Äôs no longer relevant, or interesting, and it‚Äôs been out there for years‚Äù, what if we could just toggle certain episodes? ‚Ä¶and this might be a cat and mouse game as well. But at a certain point it‚Äôs like ‚ÄúWell, just give them the R2 URL, and not the CDN URL, and just let Cloudflare deal with it.‚Äù Just let them download directly from Cloudflare, and we‚Äôre just out of the equation then. We don‚Äôt care about the stats, we don‚Äôt care about anything. We‚Äôre just like ‚Äì you know, we‚Äôve served this file plenty of times through our CDN. Now we‚Äôre going to just let R2 serve it. What do you think about that idea?</p>
            </div>


            <div>
              
              <p>I can see for this specific episode being a very simple fix, because we can just serve basically a location header, and we just redirect, and that‚Äôs it. We‚Äôre done with it. So it‚Äôd be another synthetic response.</p>
            </div>


            <div>
              
              <p>The question is if they‚Äôre actually malicious, then they switch to a new episode and start doing that one, right?</p>
            </div>


            <div>
              
              <p>Exactly. Exactly. And we have other clients, which are ‚Äì for example, we‚Äôve seen [unintelligible <a href="#t=01:30:38.28">01:30:38.28</a>] they‚Äôre basically busting the cache and then purposefully going to R2 directly, and Varnish almost acts like a proxy in this case.</p>
            </div>


            <div>
              
              <p>Right.</p>
            </div>


            <div>
<p>So we have that as well. We have ‚Äì every now and then we have this random client that comes and downloads all the episodes‚Ä¶ And that‚Äôs not a problem. So I think that some sort of a throttle would make sense, which would keep the system fair to everybody. But the throttle needs to be high enough so that it doesn‚Äôt impact anyone else.</p>
<p>Now, if for example our requests, or if our audience grows, or we become more popular, and we get more requests - obviously, we‚Äôd need to be aware of where the limit is, and start increasing the limits, once we are throttling too much, maybe. But that seems to be more like long-term, and it seems like a more well-engineered approach, in a way‚Ä¶ But certainly, the simplest thing would be just ‚ÄúTake this one URL.‚Äù I mean, that could be done in minutes, roll it out, and then we would stop this abuse for this specific MP3. That would be the easiest thing, for sure. So yeah, I can see how pragmatic that approach is, and I like the pragmatism.</p>

              </div>


            <div>
              
              <p>Well, it‚Äôs at least worth checking to see if, you know, the mouse is still alive over there.</p>
            </div>


            <div>
              
              <p>Right.</p>
            </div>


            <div>
              
              <p>You know?</p>
            </div>


            <div>
              
              <p>Yup.</p>
            </div>


            <div>
              
              <p>And if they are - well, then we‚Äôll know that this is a cat and mouse game. But if it‚Äôs just somebody left the blinker on, we‚Äôre just gonna turn their blinker off for them, and see if the problem goes away. And if it changes to a new MP3, then yeah, we need more generic solutions. But we may not need that at all.</p>
            </div>


            <div>
              
              <p>I do have to say that the internet these days is very different from the internet even like a year ago. With the rise of LLMs and AIs, I‚Äôm starting to see patterns in our traffic, which are unlike any other time. We have these very big spikes, when a lot of data is being requested in a very short periods of time, from ‚Äì I mean, the user agents, they don‚Äôt make much sense‚Ä¶ I mean, I know they‚Äôre spoofed. There are many IPs which are being used‚Ä¶ So it‚Äôs almost like there‚Äôs some system which wants a lot of our content is doing silly things, because some requests, they just don‚Äôt make sense. For example, what benefit does static favicon have? What‚Äôs up with that? That just makes no sense.</p>
            </div>


            <div>
              
              <p>It‚Äôs a small file. Maybe it‚Äôs a heartbeat, or a version of a heartbeat.</p>
            </div>


            <div>
              
              <p>Maybe‚Ä¶ But this is the first time I‚Äôve seen this specific file being downloaded this many times. I haven‚Äôt seen this before‚Ä¶ Which makes me think, is this a trend that we‚Äôll start seeing, more and more requests that don‚Äôt make sense? And then you start having to set up some form of protection for all sorts of clients that are just doing the wrong thing.</p>
            </div>


            <div>
              
              <p>Yeah, you need like a defensive layer by default.</p>
            </div>


            <div>
<p>Exactly. Exactly, yeah. And something that would be fair to regular clients‚Ä¶ Like, for example when I want to do a benchmark‚Ä¶ I mean, sure, it‚Äôs me. I wouldn‚Äôt want other people to do that, because I‚Äôm testing the system, making sure the real world production system everywhere in the world is working correctly‚Ä¶ And I‚Äôm aware of what that means, and how it costs‚Ä¶ And by the way, my IPs are removed from all the stats, because otherwise you‚Äôd see those massive benchmarks‚Ä¶ So we account for that. But we can‚Äôt account for all these weird clients.</p>
<p>[<a href="#t=01:34:05.02">01:34:05.02</a>] It‚Äôs a challenge‚Ä¶ I think it‚Äôs a good one, but it just sets us up to ‚Äì you know, when you become older, it feels like this is more of an adult problem. So we got the thing barely working, we got it out there, we made it stable, reliable, all that‚Ä¶ And now we‚Äôre hitting ‚Äì it almost feels like a new layer of problems. And this to me is a hint as to the next phase.</p>

              </div>


            <div>
              
              <p>Oh, to be a kid again‚Ä¶</p>
            </div>


            <div>
              
              <p>Yeah. Well, one positive thing I think is the robustness of our observability. Being able to have this visibility is great, because otherwise we‚Äôre like ‚ÄúWow‚Ä¶‚Äù We pat ourselves on the back. ‚ÄúAaron Parecki, let‚Äôs get you back on the pod, because man, you are big all over the world. That‚Äôs amazing. A million downloads.‚Äù</p>
            </div>


            <div>
              
              <p>Big in Asia. So what‚Äôs your one last thing for the road ahead? I agree [unintelligible <a href="#t=01:34:54.22">01:34:54.22</a>]</p>
            </div>


            <div>
              
              <p>What‚Äôs my one last thing? So I‚Äôll keep it short, we‚Äôll keep it fun. I mentioned about the Christmas tree, I mentioned about the various things which I had going over the holidays‚Ä¶ So - Make It Work Club. That‚Äôs the place. You‚Äôre there. Both of you are there. So you can join whenever you want. Next Thursday‚Ä¶ Yeah, next Thursday. I‚Äôm going to talk about the 100-gigabit WAN. The 100-gigabit WAN. So why would I need such a thing?</p>
            </div>


            <div>
              
              <p>Smokin‚Äô.</p>
            </div>


            <div>
<p>It‚Äôs smokin‚Äô, for sure. So I thought the CCR 2004 has like four CPUs, has multiple 10-gigabit SFP+ ports‚Ä¶ It even has 24 SFP28 ports, but it doesn‚Äôt have a switch chip. And people that know a little bit about hardware, you want to switch chip to do hardware offloading L3, and even L4. So after I bought the CCR 2004 - it was almost like a Christmas present - I thought ‚ÄúSurely, this will be enough for the rest of my life.‚Äù And no, I had to get the flagship. So I‚Äôll be talking about that - the LAN, the setup, quite a few things - coming up. And it just goes to show how much I enjoy the hardware side of things as well, the networking side of things‚Ä¶ Like, I shaved two milliseconds off my WAN. It‚Äôs amzing. Little things like that. It was already good. It was already sub five milliseconds, but I wanted sub three milliseconds. It is now 2.4 milliseconds. So the next ‚Äì and what it means‚Ä¶ Like, why would I do this? So first of all, I‚Äôm all about improving. Every winter I improve the network. In this specific instance, I wanted the pages just to be snappier, things to load a lot quicker, to handle a bit more traffic, but also to not have any impact‚Ä¶ I was running that benchmark, 2.5, like ‚Äì look, I‚Äôm going to do another one right now. Let‚Äôs see. I have a speed test‚Ä¶ I have speed test right here, speed test London‚Ä¶ Let‚Äôs go for this one. So we‚Äôre recording, we‚Äôre streaming, and I‚Äôm just pulling 2.5, 2.6 gigabits down. And there‚Äôs no interruption on my network. So it‚Äôs just my bread and butter. That‚Äôs how I work.</p>
<p>[<a href="#t=01:37:20.27">01:37:20.27</a>] And by the way, if you see any buffering or any slowing down, let me know. I see Adam a bit more pixelated. Maybe you can see pixelated too, I don‚Äôt know‚Ä¶ But yeah, I just pulled six gigabytes, three down, three up‚Ä¶ And it‚Äôs just what I do every day.</p>

              </div>


            <div>
              
              <p>It‚Äôs just what he does.</p>
            </div>


            <div>
              
              <p>I work with this stuff, and ‚Äì yeah, I enjoy it. And by the way, this is the slower gateway router. So I‚Äôm getting the proper one set up, and I‚Äôll talk about that. And there‚Äôs so many things there. VLANing is quite a thing‚Ä¶ I have a new IPv4 block, by the way‚Ä¶ So some would say that I‚Äôm preparing for hosting something. And maybe I am, I don‚Äôt know. We‚Äôll see how that works. But I just realized that my home connection - obviously, I couldn‚Äôt serve all the MP3s that were being downloaded. That would really cripple my connection if that was happening‚Ä¶ But I‚Äôm at 2.5 gigabits. The next one will be five gigabits, and the hardware can do it. And the five gigabits - I mean, that‚Äôs like a decent server.</p>
            </div>


            <div>
              
              <p>Sure.</p>
            </div>


            <div>
              
              <p>And if you can do five gigabits all day, every day‚Ä¶ Sorry. Yeah, gigabits. Gigabits per second. That‚Äôs pretty decent. So I‚Äôm just waiting for more internet.</p>
            </div>


            <div>
              
              <p>I was gonna say, you‚Äôre gonna have a hundred gigabit WAN, but you‚Äôre not gonna have a connection for it, right?</p>
            </div>


            <div>
              
              <p>Right. So‚Ä¶ Very few places in the world have that. So if I was in Switzerland, I would get 25 gigabits.</p>
            </div>


            <div>
              
              <p>Now, would you move? Would you move for this?</p>
            </div>


            <div>
              
              <p>Of course.</p>
            </div>


            <div>
              
              <p>[laughs] ‚ÄúOf course‚Ä¶‚Äù</p>
            </div>


            <div>
              
              <p>The only reason to move‚Ä¶</p>
            </div>


            <div>
              
              <p>I know that sensation.</p>
            </div>


            <div>
              
              <p>Yeah. It‚Äôs the 25-gigabit connection. But I know that a hundred gig is coming‚Ä¶ So we‚Äôll see. They either ship it by the time I move, or I move, and then they ship it. So it‚Äôs one or the other.</p>
            </div>


            <div>
              
              <p>Okay.</p>
            </div>


            <div>
              
              <p>The important thing is, I have the router to handle that.</p>
            </div>


            <div>
              
              <p>You‚Äôll be ready. You‚Äôll be ready.</p>
            </div>


            <div>
              
              <p>I‚Äôll be ready. Exactly. So I‚Äôm a prepper‚Ä¶ I‚Äôm prepping for that.</p>
            </div>


            <div>
              
              <p>Prepping for good internet.</p>
            </div>


            <div>
              
              <p>And interestingly ‚Äì five years ago, when I got the previous router, I did the same thing. It‚Äôs a forum post, it‚Äôs like a follow-up‚Ä¶ So I just did a follow-up recently, at this milestone‚Ä¶ So I‚Äôve been at this for some number of years, and optimizing my network and making sure that it‚Äôs in tip top condition.</p>
            </div>


            <div>
              
              <p>Relentless‚Ä¶ I love it. So relentless.</p>
            </div>


            <div>
              
              <p>Good stuff, Gerhard. Well, that‚Äôs a happy note to end on, right? That‚Äôs a happy note to end on.</p>
            </div>


            <div>
              
              <p>Observability in a hundred gigabit? That‚Äôs the way to do it.</p>
            </div>


            <div>
              
              <p>Alright. Well, the good news for Kaizen is we have a lot to work on.</p>
            </div>


            <div>
              
              <p>Always. Always.</p>
            </div>


            <div>
              
              <p>That‚Äôs what it seems. We know how to pick them, don‚Äôt we?</p>
            </div>


            <div>
              
              <p>Oh, my gosh‚Ä¶ The rabbit hole goes deep, and we keep going in.</p>
            </div>


            <div>
              
              <p>Kaizen!</p>
            </div>


            <div>
              
              <p>Bye, friends.</p>
            </div>


            <div>
              
              <p>Kaizen.</p>
            </div>

          

        </div>
      </section>

      
    </div></div>
  </div>
</body>
</html>