<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Make offpeak hours available in Domoticz Settings</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.55; color: #e2e8f0; max-width: 800px; margin: 26px auto; padding: 0 18px; background: #0a0e27; }
  h1 { color: #00d9ff; margin-bottom: 0.35em; line-height: 1.22; font-size: clamp(1.45rem, 2.1vw, 1.95rem); font-weight: 700; }
  h2, h3 { line-height: 1.28; margin: 1.1em 0 0.45em; }
  .metadata { color: #94a3b8; font-size: 0.86em; margin-bottom: 1.2em; border-bottom: 1px solid rgba(0,217,255,0.2); padding-bottom: 0.7em; }
  img { max-width: 100%; width: auto !important; height: auto !important; object-fit: contain !important; border-radius: 8px; display: block; margin: 0.6em auto; }
  a { color: #00d9ff; }
  p { margin-bottom: 0.72em; line-height: 1.58; }
  ul, ol { margin: 0.5em 0 0.9em 1.1em; }
  li { margin: 0.18em 0; }
  blockquote { border-left: 3px solid #825ee4; padding-left: 12px; margin: 0.8em 0; color: #94a3b8; }
  code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px; color: #ff79c6; }
  pre { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; overflow-x: auto; }
  .article-elevator { position: fixed; right: 14px; bottom: 14px; display: flex; flex-direction: column; gap: 8px; z-index: 9999; }
  .article-elevator-btn { width: 36px; height: 36px; border: 1px solid rgba(0,217,255,0.35); border-radius: 10px; background: rgba(10,14,39,0.88); color: #00d9ff; cursor: pointer; font-size: 16px; line-height: 1; }
  .article-elevator-btn:hover { background: rgba(10,14,39,1); }
  [id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"],
  [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"],
  [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }
</style>
</head>
<body>
  <h1>Make offpeak hours available in Domoticz Settings</h1>
  <div class="metadata">
    Source: Domoticz (Forum News) | Date: 2/2/2026 11:28:59 PM | <a href="https://forum.domoticz.com/viewtopic.php?p=331312#p331312" target="_blank" rel="noopener noreferrer">Lien</a> | Lang: EN
  </div>
  <div class="content">
    <div><div><blockquote><p><cite><a href="https://forum.domoticz.com/memberlist.php?mode=viewprofile&amp;u=23529&amp;sid=8d762937385c79917a6370b1889de30f">waltervl</a> wrote: <a href="https://forum.domoticz.com/viewtopic.php?p=331320&amp;sid=8d762937385c79917a6370b1889de30f#p331320"></a><span>Tuesday 03 February 2026 13:48</span></cite>
Please define offpeak hours.<br>
Is that the hours with lowest energy tariffs? </p></blockquote><p> For my usage, yes.</p><p> I'm working on a plugin to smart charge my EV car.<br>
In France, most of users are with the national company, EDF.<br>
Within this company, you can choose different contracts, for different power, single or tri phase, and you can select if you want some hours with lower cost (at night, in majority) = dual tariff.<br>
"if you want" means you can select a "normal" contract, without any offpeak hours (single tariff).</p><p> I have a domestic battery which is charging during offpeak hours (23:30 - 7:30 for me)<br>
the battery is set to always keep at least 50%<br>
From 7:30, the battery is discharging until it reaches 50% (without solar, it happens around 13:30)<br>
If solar production is good, the battery is able to charge and powering the home. Then the 50% is reached at 17:30, during this winter.<br>
If and when I will have too much power, I will adapt the script.</p><p> My smart charge logic is:<br>
when the car starts charging, check if we are in offpeak hours (wall charger is hard-coded to deliver energy only between 2330-0730).<br>
if we are, calculate how much kWh is needed to reach the charge limit (read from the car), then reduce car charging power (amperage) so that charge ends at or before 7:30 (knowing min and max amps, and car battery capacity)<br>
if we are not, check if car is lower than 25%<br>
if yes, charge at max amps until 25%, then stop charge and wait for offpeak hours<br>
if not, stop the charge</p><p> The goal is to use the lowest charge speed possible to reach the target, without using max power.<br>
At the moment, I'm using a USB TIC device, which creates an alert sensor for offpeak hours (alert 1) or normal hours (alert 2).<br>
But I wanted my plugin to be usable by everybody<br>
As a replacement, I'm using User Variables.</p><p> As we are able to set <strong>Cost T1</strong> and <strong>Cost T2</strong> (in Settings, Meters/Counters), and those settings are readable from </p><div><p>Code: <a href="#">Select all</a></p><pre><code>json.htm?type=command&amp;param=getsettings</code></pre></div><p> I was expecting the same feature for hours for T1 and T2</p><p> The advantage of this webpage (json.htm) is that it can be read without password if exception is set for 127.0.0.1</p><p> I also would like to see the current domoticz HTTP/HTTPS running port in this webpage, should I create a new subject?<br>
I would use it to create a room plan at first plugin start to assign all new devices to a specific plan.<br>
Here: <a href="https://github.com/lemassykoi/Domoticz-OpenDTU-Plugin/blob/ffdeeb2507b433210ad8f9c7ef8d929d680f7816/plugin.py#L346">OpenDTU Plugin</a> I assume the port is 80</p><p> Thanks</p></div></div>
  </div>
  <div class="article-elevator" aria-label="Navigation article">
    <button class="article-elevator-btn" type="button" onclick="scrollToTop()">▲</button>
    <button class="article-elevator-btn" type="button" onclick="scrollToBottom()">▼</button>
  </div>
  <script>
    function stripBlockingPanels() {
      const selector = '[id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"], [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"], [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"]';
      const textPattern = /\b(cookie|consent|gdpr|subscribe|subscription|paywall|abonnez[-\s]?vous|inscrivez[-\s]?vous|continue reading|continuez la lecture)\b/i;
      document.querySelectorAll(selector).forEach((node) => node.remove());
      document.querySelectorAll('div, section, aside').forEach((node) => {
        const styleAttr = String(node.getAttribute('style') || '').toLowerCase();
        const classAndId = String(node.className || '').toLowerCase() + ' ' + String(node.id || '').toLowerCase();
        const text = String(node.textContent || '').slice(0, 800);
        const hasKeyword = textPattern.test(classAndId) || textPattern.test(text);
        const looksFixed = /(position\s*:\s*(fixed|sticky)|inset\s*:|top\s*:|left\s*:|right\s*:|bottom\s*:)/.test(styleAttr);
        const hasPriority = /(z-index\s*:\s*[1-9]\d{1,}|backdrop-filter|overflow\s*:\s*hidden)/.test(styleAttr);
        if (hasKeyword && (looksFixed || hasPriority)) node.remove();
      });
    }
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'auto' });
    }
    function scrollToBottom() {
      window.scrollTo({ top: document.documentElement.scrollHeight, behavior: 'auto' });
    }
    window.addEventListener('message', (event) => {
      const data = event && event.data;
      if (!data || data.type !== 'AI_PULSE_SCROLL') return;
      if (data.direction === 'up' || data.direction === 'top') scrollToTop();
      if (data.direction === 'down' || data.direction === 'bottom') scrollToBottom();
    });
    stripBlockingPanels();
    setTimeout(stripBlockingPanels, 60);
    setTimeout(stripBlockingPanels, 220);
    setTimeout(stripBlockingPanels, 650);
  </script>
</body>
</html>