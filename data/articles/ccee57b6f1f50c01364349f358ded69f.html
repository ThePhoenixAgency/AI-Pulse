<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Erreur démarrage Z2m</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.55; color: #e2e8f0; max-width: 800px; margin: 26px auto; padding: 0 18px; background: #0a0e27; }
  h1 { color: #00d9ff; margin-bottom: 0.35em; line-height: 1.22; font-size: clamp(1.45rem, 2.1vw, 1.95rem); font-weight: 700; }
  h2, h3 { line-height: 1.28; margin: 1.1em 0 0.45em; }
  .metadata { color: #94a3b8; font-size: 0.86em; margin-bottom: 1.2em; border-bottom: 1px solid rgba(0,217,255,0.2); padding-bottom: 0.7em; }
  img { max-width: 100%; width: auto !important; height: auto !important; object-fit: contain !important; border-radius: 8px; display: block; margin: 0.6em auto; }
  a { color: #00d9ff; }
  p { margin-bottom: 0.72em; line-height: 1.58; }
  ul, ol { margin: 0.5em 0 0.9em 1.1em; }
  li { margin: 0.18em 0; }
  blockquote { border-left: 3px solid #825ee4; padding-left: 12px; margin: 0.8em 0; color: #94a3b8; }
  code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px; color: #ff79c6; }
  pre { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; overflow-x: auto; }
  .article-elevator { position: fixed; right: 14px; bottom: 14px; display: flex; flex-direction: column; gap: 8px; z-index: 9999; }
  .article-elevator-btn { width: 36px; height: 36px; border: 1px solid rgba(0,217,255,0.35); border-radius: 10px; background: rgba(10,14,39,0.88); color: #00d9ff; cursor: pointer; font-size: 16px; line-height: 1; }
  .article-elevator-btn:hover { background: rgba(10,14,39,1); }
  [id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"],
  [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"],
  [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }
</style>
</head>
<body>
  <h1>Erreur démarrage Z2m</h1>
  <div class="metadata">
    Source: Gladys Assistant (Forum) | Date: 2/23/2026 7:10:12 PM | <a href="https://community.gladysassistant.com/t/erreur-demarrage-z2m/10049" target="_blank" rel="noopener noreferrer">Lien</a> | Lang: FR
  </div>
  <div class="content">
    <div><div> <div> <div> <p><span> <time> Février 23, 2026, 7:10 </time> <span>1</span> </span> </p></div> <div> <p>Bonsoir,</p>
<p>J’ai dû déplacer mon serveur et en le remontant, j’ai dû me tromper de port USB pour mon dongle Sonoff… <img src="https://gladys-assistant-community.b-cdn.net/images/emoji/apple/winking_face_with_tongue.png?v=15" alt=":winking_face_with_tongue:"> et donc lorsque je redémarre le tout, j’ai maintenant :</p>
<p>Gladys log :<br>
</p><div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/0/c/0c55f9c0cbcaabe652e26d3e1c46d042c6de90f7.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/0/c/0c55f9c0cbcaabe652e26d3e1c46d042c6de90f7_2_690x183.png" alt="Screenshot From 2026-02-23 20-05-42"></a></div>
<p>Z2m log :<br>
</p><div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/0/c/0cf2a803345e31be2f45f296d49d766e26f055c2.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/0/c/0cf2a803345e31be2f45f296d49d766e26f055c2.png" alt="Screenshot From 2026-02-23 20-06-22"></a></div>
<p>J’ai essayé de troubleshooter mais je ne suis pas au top avec tout ça.</p>
<p>Je veux bien une petite séance de troubleshootage qui pourra servir à tous j’espère <img src="https://gladys-assistant-community.b-cdn.net/images/emoji/apple/sweat_smile.png?v=15" alt=":sweat_smile:"></p>
<p>Merci d’avance.</p> </div> </div> <div> <p><span> <a href="https://community.gladysassistant.com/u/mutmut"><span>mutmut</span></a> </span> <span> <time> Février 23, 2026, 7:49 </time> <span>2</span> </span> </p> <p>hello,<br>
côté Gladys ça parle de <code>zstack</code> en driver, ton dongle n’est pas en <code>ezsp</code>ou <code>ember</code> normalement ?</p> </div> <div> <p>merci pour le retour mais je n’ai strictement rien changé si ce n’est rebranché le dongle sur un autre port USB je crois. Ensuite je l’ai remis sur le port USB original et refait la config. J’ai donc ça :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/e/9/e9cdec7d1284ba712aa3ea87638c6fff3cd4712d.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/e/9/e9cdec7d1284ba712aa3ea87638c6fff3cd4712d_2_469x500.png" alt="Screenshot From 2026-02-23 21-16-09"></a></div> </div> <div> <p><span> <a href="https://community.gladysassistant.com/u/mutmut"><span>mutmut</span></a> </span> <span> <time> Février 23, 2026, 8:32 </time> <span>4</span> </span> </p> <p>Je ne vais pas pouvoir t’aider malheureusement car je suis en SMLIGHT via ethernet et non usb, donc peu de connaissance sur ces problèmes.</p> <div> <p><span>1 « J'aime »</span> </p></div> </div> <div> <p>Bon ben ce soir je vais tout éteindre à la mano <img src="https://gladys-assistant-community.b-cdn.net/images/emoji/apple/winking_face_with_tongue.png?v=15" alt=":winking_face_with_tongue:"></p> </div> <div> <p>J’ai vraiment besoin d’aide, merci d’avance.</p>
<p>Ce que je ne comprends pas dans les logs, c’est :</p>
<ol>
<li>container already stopped</li>
<li>container with USB dongle path /dev/ttyUSB1 should be removed</li>
</ol>
<blockquote>
<p>2026-02-24T09:59:58+0100 installMqttContainer.js:114 (Zigbee2mqttManager.installMqttContainer) MQTT broker container successfully started<br>
2026-02-24T09:59:58+0100 installZ2mContainer.js:34 (Zigbee2mqttManager.installZ2mContainer) Zigbee2mqtt container with USB dongle path /dev/ttyUSB1 should be removed (new USB dongle path /dev/ttyUSB0 configured)…<br>
2026-02-24T09:59:58+0100 errorMiddleware.js:68 (errorMiddleware) Error: (HTTP code 304) container already stopped -</p>
</blockquote>
<p>sachant que :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/b/e/be005cb093a76b417eac8dcfd57711fb85a1c364.jpeg"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/b/e/be005cb093a76b417eac8dcfd57711fb85a1c364.jpeg" alt="Web_Photo_Editor"></a></div>
<p>Que faire ?</p> </div> <div> <p>Salut <a href="https://community.gladysassistant.com/u/jcmoriaud">@jcmoriaud</a>,</p>
<p>Les logs indiquent que Gladys essaie de stopper le container pour modifier la configuration avec le nouveau port USB, sauf que le container est déjà stoppé et visiblement Gladys n’aime pas trop.</p>
<p>Pour voir les containers sur ta machine, y compris ceux stoppés, tu peux faire :</p>
<pre><code>sudo docker ps -a
</code></pre>
<p>Si le container <code>gladys-z2m-zigbee2mqtt</code> est bien là et stoppé, tu peux faire:</p>
<pre><code>sudo docker rm gladys-z2m-zigbee2mqtt
</code></pre>
<p>Ce qui supprimera le container Zigbee2mqtt et débloquera la situation.</p>
<p>Ensuite, retourne dans l’interface et re-active l’intégration, ce qui devrait relancer un container avec le bon port USB !</p>
<p>Tiens nous au courant si tu as une autre erreur suite à ça <img src="https://gladys-assistant-community.b-cdn.net/images/emoji/apple/slight_smile.png?v=15" alt=":slight_smile:"></p> </div> <div> <p>Alors effectivement je voyais avec le “ps -a” le conteneur en “exited”. J’ai donc fait le rm et c’est reparti :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/7/4/74c8073f54876d7d30bcf7283f3989da24ce2abb.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/7/4/74c8073f54876d7d30bcf7283f3989da24ce2abb_2_690x239.png" alt="Screenshot From 2026-02-24 18-32-44"></a></div>
<p>En revanche, j’ai plus de lien entre les 3 conteneurs :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/7/5/75add18218ee563db947475032a195f1429e6049.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/7/5/75add18218ee563db947475032a195f1429e6049_2_690x378.png" alt="Screenshot From 2026-02-24 18-41-36"></a></div>
<p>et j’ai ça dans les logs :</p>
<blockquote>
<p>2026-02-24 17:42:14] info: z2m: Currently 10 devices are joined.<br>
[2026-02-24 17:42:14] info: z2m: Connecting to MQTT server at mqtt://localhost:1884<br>
[2026-02-24 17:42:14] error: z2m: MQTT failed to connect, exiting… (connect ECONNREFUSED 127.0.0.1:1884)</p>
</blockquote>
<p>et:</p>
<blockquote>
<p>026-02-24T18:35:59+0100 scene.actions.js:192 () BadParameters [Error]: Zigbee2mqtt expose not found: «&nbsp;zigbee2mqtt:0xa4c138db0c5ad722:switch:binary:state&nbsp;» with property «&nbsp;state&nbsp;»<br>
at Zigbee2mqttManager.setValue (/src/server/services/zigbee2mqtt/lib/setValue.js:38:11)<br>
at DeviceManager.setValue (/src/server/lib/device/device.setValue.js:22:24)<br>
at /src/server/lib/scene/scene.actions.js:190:27<br>
at tryCatcher (/src/server/node_modules/bluebird/js/release/util.js:16:23)<br>
at MappingPromiseArray._promiseFulfilled (/src/server/node_modules/bluebird/js/release/map.js:68:38)<br>
at MappingPromiseArray.PromiseArray._iterate (/src/server/node_modules/bluebird/js/release/promise_array.js:115:31)<br>
at MappingPromiseArray.init (/src/server/node_modules/bluebird/js/release/promise_array.js:79:10)<br>
at MappingPromiseArray._asyncInit (/src/server/node_modules/bluebird/js/release/map.js:37:10)<br>
at _drainQueueStep (/src/server/node_modules/bluebird/js/release/async.js:97:12)<br>
at _drainQueue (/src/server/node_modules/bluebird/js/release/async.js:86:9)<br>
at Async._drainQueues (/src/server/node_modules/bluebird/js/release/async.js:102:5)<br>
at Immediate.Async.drainQueues (/src/server/node_modules/bluebird/js/release/async.js:15:14)<br>
at processImmediate (node:internal/timers:485:21)<br>
2026-02-24T18:36:00+0100 connect.js:46 (MqttClient.) Error while connecting to MQTT - Error: connect ECONNREFUSED 127.0.0.1:1884<br>
2026-02-24T18:36:05+0100 connect.js:46 (MqttClient.) Error while connecting to MQTT - Error: connect ECONNREFUSED 127.0.0.1:1884<br>
2026-02-24T18:36:10+0100 connect.js:46 (MqttClient.) Error while connecting to MQTT - Error: connect ECONNREFUSED 127.0.0.1:1884</p>
</blockquote>
<p>je vais check le firewall…</p> </div> <div> <p>Le container mosquitto dédié à Zigbee2mqtt est up ?</p>
<p>Regarde ses logs pour voir qu’est ce qui ne va pas</p> </div> <div> <p>les conteneurs sont tous up :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/c/7/c75060ec339c04ab2572763172b095559763bf57.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/c/7/c75060ec339c04ab2572763172b095559763bf57_2_690x80.png" alt="Screenshot From 2026-02-24 19-45-44"></a></div>
<p>les logs :</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/a/3/a30da0a663684fb01461fc6ff8114b922eb4eea9.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/optimized/3X/a/3/a30da0a663684fb01461fc6ff8114b922eb4eea9_2_690x232.png" alt="Screenshot From 2026-02-24 19-46-44"></a></div>
<p>et</p>
<div><a href="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/1/d/1d062646d006a807970a6a2390536780fe2ecf32.png"><img src="https://gladys-assistant-community.b-cdn.net/uploads/default/original/3X/1/d/1d062646d006a807970a6a2390536780fe2ecf32.png" alt="Screenshot From 2026-02-24 19-47-44"></a></div>
<p>je vois bien les erreurs… mais après…</p>
<p>Un port ufw fermé ?</p> </div> <div> <p>Le container «&nbsp;mosquitto&nbsp;» redémarre en boucle car il ne trouve pas son fichier de configuration.</p>
<p>Il me semble que tu m’as dit que tu avais supprimé tout le dossier «&nbsp;zigbee2mqtt&nbsp;», non ? <img src="https://gladys-assistant-community.b-cdn.net/images/emoji/apple/sweat_smile.png?v=15" alt=":sweat_smile:"></p>
<p>Est-ce que tu as essayé de désactiver l’intégration Zigbee2mqtt (avec le toggle bleu) ?</p>
<p>Attends bien que tous les containers soient stoppés. (Tu peux vérifier avec <code>docker ps</code>)</p>
<p>Puis clique à nouveau sur le toggle, normalement les fichiers de configuration seront recréés s’ils sont manquants.</p> </div> <div> <div> <p>Oui j’avais bien supprimé le conteneur.</p>
<p>J’ai refait la séquence comme indiqué et c’est tout bon ! Au top, merci !!!</p>
<p>Je pose la question au risque de dire une grosse c… mais est-ce que cette situation, si elle arrive parfois (je n’ose pas imaginer que je suis le seul…), ne pourrait pas être résolue automatiquement ?</p> </div> <div> <p><span>1 « J'aime »</span> </p></div> </div> <div> <p>Excellent !! Tant mieux !</p> <div> <p><span>1 « J'aime »</span> </p></div> </div> </div></div>
  </div>
  <div class="article-elevator" aria-label="Navigation article">
    <button class="article-elevator-btn" type="button" onclick="scrollToTop()">▲</button>
    <button class="article-elevator-btn" type="button" onclick="scrollToBottom()">▼</button>
  </div>
  <script>
    function stripBlockingPanels() {
      const selector = '[id*="overlay"], [class*="overlay"], [id*="modal"], [class*="modal"], [id*="popup"], [class*="popup"], [id*="paywall"], [class*="paywall"], [id*="subscribe"], [class*="subscribe"], [id*="cookie"], [class*="cookie"], [id*="consent"], [class*="consent"], [id*="gdpr"], [class*="gdpr"], [role="dialog"], [aria-modal="true"]';
      const textPattern = /\b(cookie|consent|gdpr|subscribe|subscription|paywall|abonnez[-\s]?vous|inscrivez[-\s]?vous|continue reading|continuez la lecture)\b/i;
      document.querySelectorAll(selector).forEach((node) => node.remove());
      document.querySelectorAll('div, section, aside').forEach((node) => {
        const styleAttr = String(node.getAttribute('style') || '').toLowerCase();
        const classAndId = String(node.className || '').toLowerCase() + ' ' + String(node.id || '').toLowerCase();
        const text = String(node.textContent || '').slice(0, 800);
        const hasKeyword = textPattern.test(classAndId) || textPattern.test(text);
        const looksFixed = /(position\s*:\s*(fixed|sticky)|inset\s*:|top\s*:|left\s*:|right\s*:|bottom\s*:)/.test(styleAttr);
        const hasPriority = /(z-index\s*:\s*[1-9]\d{1,}|backdrop-filter|overflow\s*:\s*hidden)/.test(styleAttr);
        if (hasKeyword && (looksFixed || hasPriority)) node.remove();
      });
    }
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'auto' });
    }
    function scrollToBottom() {
      window.scrollTo({ top: document.documentElement.scrollHeight, behavior: 'auto' });
    }
    window.addEventListener('message', (event) => {
      const data = event && event.data;
      if (!data || data.type !== 'AI_PULSE_SCROLL') return;
      if (data.direction === 'up' || data.direction === 'top') scrollToTop();
      if (data.direction === 'down' || data.direction === 'bottom') scrollToBottom();
    });
    stripBlockingPanels();
    setTimeout(stripBlockingPanels, 60);
    setTimeout(stripBlockingPanels, 220);
    setTimeout(stripBlockingPanels, 650);
  </script>
</body>
</html>